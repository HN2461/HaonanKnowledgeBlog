# ç¬¬äºŒç¯‡ã€€è¯­æ³•åŸºç¡€â€”â€”æ„å»ºè¯­è¨€æ ¹åŸº

# ç¬¬4ç« ã€€å˜é‡ä¸å¸¸é‡

å˜é‡æ˜¯ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€æ¦‚å¿µï¼ŒJavaScriptæä¾›äº†ä¸‰ç§å£°æ˜å˜é‡çš„æ–¹å¼ï¼š`var`ã€`let`å’Œ`const`ã€‚ç†è§£å®ƒä»¬çš„å·®å¼‚å’Œé€‚ç”¨åœºæ™¯ï¼Œæ˜¯æŒæ¡JavaScriptçš„é‡è¦ä¸€æ­¥ã€‚

## 4.1 varã€letã€const çš„æ ¹æœ¬å·®å¼‚

### å˜é‡å£°æ˜æ–¹å¼æ¦‚è§ˆ

JavaScriptæä¾›äº†ä¸‰ç§å˜é‡å£°æ˜å…³é”®å­—ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‰¹å®šçš„è¡Œä¸ºå’Œé€‚ç”¨åœºæ™¯ï¼š

| å…³é”®å­— | å¼•å…¥ç‰ˆæœ¬ | ä½œç”¨åŸŸ | å¯é‡å¤å£°æ˜ | å¯é‡æ–°èµ‹å€¼ | å˜é‡æå‡ | æš‚æ—¶æ€§æ­»åŒº |
|--------|----------|--------|------------|------------|----------|------------|
| `var` | ES3 | å‡½æ•°ä½œç”¨åŸŸ | âœ… æ˜¯ | âœ… æ˜¯ | âœ… æ˜¯ | âŒ å¦ |
| `let` | ES6 | å—çº§ä½œç”¨åŸŸ | âŒ å¦ | âœ… æ˜¯ | ğŸ”¶ æœ‰ä½†ä¸å¯è®¿é—® | âœ… æ˜¯ |
| `const` | ES6 | å—çº§ä½œç”¨åŸŸ | âŒ å¦ | âŒ å¦ | ğŸ”¶ æœ‰ä½†ä¸å¯è®¿é—® | âœ… æ˜¯ |

### varï¼šä¼ ç»Ÿçš„å˜é‡å£°æ˜

`var`æ˜¯JavaScriptæœ€æ—©çš„å˜é‡å£°æ˜æ–¹å¼ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

#### 1. å‡½æ•°ä½œç”¨åŸŸ
```javascript
function varScopeExample() {
    if (true) {
        var message = 'Hello World';
    }
    
    // varå£°æ˜çš„å˜é‡åœ¨æ•´ä¸ªå‡½æ•°å†…éƒ½å¯è®¿é—®
    console.log(message); // è¾“å‡º: Hello World
}

varScopeExample();
```

#### 2. å…è®¸é‡å¤å£°æ˜
```javascript
var name = 'Alice';
var name = 'Bob';      // ä¸ä¼šæŠ¥é”™ï¼Œåé¢çš„å£°æ˜ä¼šè¦†ç›–å‰é¢çš„
console.log(name);     // è¾“å‡º: Bob

// åœ¨åŒä¸€ä½œç”¨åŸŸå†…é‡å¤å£°æ˜
var age = 25;
var age = 30;
console.log(age);      // è¾“å‡º: 30
```

#### 3. å˜é‡æå‡ï¼ˆHoistingï¼‰
```javascript
console.log(hoistedVar); // è¾“å‡º: undefinedï¼ˆè€Œä¸æ˜¯æŠ¥é”™ï¼‰

var hoistedVar = 'I am hoisted';

console.log(hoistedVar); // è¾“å‡º: I am hoisted

// ä¸Šè¿°ä»£ç ç­‰åŒäºï¼š
// var hoistedVar; // å£°æ˜è¢«æå‡åˆ°é¡¶éƒ¨
// console.log(hoistedVar); // undefined
// hoistedVar = 'I am hoisted'; // èµ‹å€¼ç•™åœ¨åŸä½
```

#### 4. å¾ªç¯ä¸­çš„é—®é¢˜
```javascript
// âŒ ç»å…¸çš„varå¾ªç¯é—®é¢˜
for (var i = 0; i < 3; i++) {
    setTimeout(() => {
        console.log('varå¾ªç¯:', i); // è¾“å‡º: 3, 3, 3
    }, 100);
}

/**
 * è§£å†³varå¾ªç¯é—®é¢˜çš„æ–¹æ³•ï¼šä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°
 */
for (var j = 0; j < 3; j++) {
    (function(index) {
        setTimeout(() => {
            console.log('IIFEè§£å†³:', index); // è¾“å‡º: 0, 1, 2
        }, 200);
    })(j);
}
```

### letï¼šå—çº§ä½œç”¨åŸŸå˜é‡

`let`åœ¨ES6ä¸­å¼•å…¥ï¼Œè§£å†³äº†`var`çš„è¯¸å¤šé—®é¢˜ï¼š

#### 1. å—çº§ä½œç”¨åŸŸ
```javascript
function letScopeExample() {
    if (true) {
        let blockScoped = 'I am block scoped';
        console.log(blockScoped); // è¾“å‡º: I am block scoped
    }
    
    // console.log(blockScoped); // ReferenceError: blockScoped is not defined
}

// æ›´å¤šå—çº§ä½œç”¨åŸŸç¤ºä¾‹
{
    let x = 1;
    console.log(x); // è¾“å‡º: 1
}
// console.log(x); // ReferenceError: x is not defined

for (let i = 0; i < 3; i++) {
    // iåªåœ¨è¿™ä¸ªforå¾ªç¯å—å†…æœ‰æ•ˆ
    console.log(`å¾ªç¯å†…: ${i}`);
}
// console.log(i); // ReferenceError: i is not defined
```

#### 2. ä¸å…è®¸é‡å¤å£°æ˜
```javascript
let userName = 'Alice';
// let userName = 'Bob'; // SyntaxError: Identifier 'userName' has already been declared

// ä½†å¯ä»¥é‡æ–°èµ‹å€¼
userName = 'Charlie';
console.log(userName); // è¾“å‡º: Charlie

// ä¸åŒå—ä½œç”¨åŸŸå†…å¯ä»¥æœ‰åŒåå˜é‡
function differentBlocks() {
    let value = 1;
    
    if (true) {
        let value = 2; // è¿™æ˜¯ä¸€ä¸ªä¸åŒçš„å˜é‡
        console.log('å—å†…:', value); // è¾“å‡º: å—å†…: 2
    }
    
    console.log('å—å¤–:', value); // è¾“å‡º: å—å¤–: 1
}

differentBlocks();
```

#### 3. è§£å†³å¾ªç¯é—®é¢˜
```javascript
// âœ… letå®Œç¾è§£å†³å¾ªç¯é—®é¢˜
for (let i = 0; i < 3; i++) {
    setTimeout(() => {
        console.log('letå¾ªç¯:', i); // è¾“å‡º: 0, 1, 2
    }, 300);
}

/**
 * åˆ›å»ºå¤šä¸ªäº‹ä»¶å¤„ç†å™¨çš„å®ç”¨ç¤ºä¾‹
 */
const buttons = ['æŒ‰é’®1', 'æŒ‰é’®2', 'æŒ‰é’®3'];
const container = document.body;

for (let i = 0; i < buttons.length; i++) {
    const button = document.createElement('button');
    button.textContent = buttons[i];
    
    // æ¯ä¸ªæŒ‰é’®éƒ½èƒ½æ­£ç¡®è®°ä½è‡ªå·±çš„ç´¢å¼•
    button.addEventListener('click', () => {
        console.log(`ç‚¹å‡»äº†ç¬¬ ${i + 1} ä¸ªæŒ‰é’®: ${buttons[i]}`);
    });
    
    container.appendChild(button);
}
```

### constï¼šä¸å¯å˜å¼•ç”¨å¸¸é‡

`const`ç”¨äºå£°æ˜å¸¸é‡ï¼Œå…·æœ‰`let`çš„æ‰€æœ‰ç‰¹æ€§ï¼Œä½†æœ‰é¢å¤–é™åˆ¶ï¼š

#### 1. å¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–
```javascript
// âœ… æ­£ç¡®çš„constå£°æ˜
const PI = 3.14159;
const APP_NAME = 'My Application';

// âŒ é”™è¯¯ï¼šconstå£°æ˜å¿…é¡»åˆå§‹åŒ–
// const uninitializedConst; // SyntaxError: Missing initializer in const declaration
```

#### 2. ä¸å¯é‡æ–°èµ‹å€¼
```javascript
const GRAVITY = 9.8;
// GRAVITY = 10; // TypeError: Assignment to constant variable

const user = { name: 'Alice', age: 25 };
// user = { name: 'Bob' }; // TypeError: Assignment to constant variable

// âœ… ä½†å¯ä»¥ä¿®æ”¹å¯¹è±¡çš„å±æ€§
user.age = 26;
user.city = 'New York';
console.log(user); // è¾“å‡º: { name: 'Alice', age: 26, city: 'New York' }
```

#### 3. å¯¹è±¡å’Œæ•°ç»„çš„å¯å˜æ€§
```javascript
/**
 * constå£°æ˜çš„å¯¹è±¡å†…éƒ¨æ˜¯å¯å˜çš„
 */
const config = {
    apiUrl: 'https://api.example.com',
    timeout: 5000,
    headers: {
        'Content-Type': 'application/json'
    }
};

// âœ… å¯ä»¥ä¿®æ”¹å±æ€§
config.timeout = 10000;
config.headers.Authorization = 'Bearer token123';

// âœ… å¯ä»¥æ·»åŠ æ–°å±æ€§
config.retryCount = 3;

console.log(config);

/**
 * constå£°æ˜çš„æ•°ç»„ä¹Ÿæ˜¯å¯å˜çš„
 */
const fruits = ['apple', 'banana'];

// âœ… å¯ä»¥ä¿®æ”¹æ•°ç»„å†…å®¹
fruits.push('orange');
fruits[0] = 'grape';
console.log(fruits); // è¾“å‡º: ['grape', 'banana', 'orange']

// âŒ ä½†ä¸èƒ½é‡æ–°èµ‹å€¼æ•´ä¸ªæ•°ç»„
// fruits = ['new', 'array']; // TypeError
```

#### 4. åˆ›å»ºçœŸæ­£ä¸å¯å˜çš„å¯¹è±¡
```javascript
/**
 * ä½¿ç”¨Object.freeze()åˆ›å»ºä¸å¯å˜å¯¹è±¡
 */
const immutableConfig = Object.freeze({
    VERSION: '1.0.0',
    MAX_RETRIES: 3,
    ENDPOINTS: Object.freeze({
        API: '/api/v1',
        AUTH: '/auth'
    })
});

// å°è¯•ä¿®æ”¹ä¼šè¢«å¿½ç•¥ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™ï¼‰
immutableConfig.VERSION = '2.0.0';
console.log(immutableConfig.VERSION); // è¾“å‡º: 1.0.0

/**
 * æ·±åº¦å†»ç»“å‡½æ•°
 * @param {Object} obj - è¦å†»ç»“çš„å¯¹è±¡
 * @returns {Object} æ·±åº¦å†»ç»“åçš„å¯¹è±¡
 */
function deepFreeze(obj) {
    // è·å–å¯¹è±¡æ‰€æœ‰å±æ€§å
    Object.getOwnPropertyNames(obj).forEach(prop => {
        const value = obj[prop];
        
        // å¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡ï¼Œé€’å½’å†»ç»“
        if (value && typeof value === 'object') {
            deepFreeze(value);
        }
    });
    
    return Object.freeze(obj);
}

const deeplyImmutable = deepFreeze({
    settings: {
        theme: 'dark',
        language: 'zh-CN'
    },
    features: ['search', 'filter']
});

// æ·±å±‚å±æ€§ä¹Ÿæ— æ³•ä¿®æ”¹
deeplyImmutable.settings.theme = 'light'; // åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ¥é”™
console.log(deeplyImmutable.settings.theme); // è¾“å‡º: dark
```

### ä¸‰è€…å¯¹æ¯”æ€»ç»“

#### å®é™…åº”ç”¨åœºæ™¯å¯¹æ¯”

```javascript
/**
 * å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨ç¤ºä¾‹
 */

// 1. é…ç½®å¸¸é‡ - ä½¿ç”¨const
const CONFIG = {
    API_BASE_URL: 'https://api.myapp.com',
    CACHE_DURATION: 300000, // 5åˆ†é’Ÿ
    MAX_FILE_SIZE: 10 * 1024 * 1024 // 10MB
};

// 2. å‡½æ•°å†…çš„ä¸´æ—¶å˜é‡ - ä½¿ç”¨let
function processUserData(users) {
    let totalAge = 0;
    let validUsers = 0;
    
    for (let i = 0; i < users.length; i++) {
        let user = users[i];
        
        if (user.age && user.age > 0) {
            totalAge += user.age;
            validUsers++;
        }
    }
    
    return validUsers > 0 ? totalAge / validUsers : 0;
}

// 3. é—ç•™ä»£ç æˆ–ç‰¹æ®Šéœ€æ±‚ - å¯èƒ½ä½¿ç”¨var
function legacyFunction() {
    // varåœ¨æŸäº›æ—§ä»£ç åº“ä¸­ä»ç„¶å­˜åœ¨
    if (typeof someGlobalVar === 'undefined') {
        var someGlobalVar = 'default value';
    }
    
    return someGlobalVar;
}

/**
 * æ¨¡å—æ¨¡å¼ä¸­çš„å˜é‡å£°æ˜
 */
const UserModule = (function() {
    // ç§æœ‰å˜é‡
    let users = [];
    const MAX_USERS = 100;
    
    // å…¬å…±æ¥å£
    return {
        /**
         * æ·»åŠ ç”¨æˆ·
         * @param {Object} user - ç”¨æˆ·å¯¹è±¡
         * @returns {boolean} æ˜¯å¦æ·»åŠ æˆåŠŸ
         */
        addUser(user) {
            if (users.length >= MAX_USERS) {
                console.warn('ç”¨æˆ·æ•°é‡å·²è¾¾ä¸Šé™');
                return false;
            }
            
            users.push(user);
            return true;
        },
        
        /**
         * è·å–ç”¨æˆ·æ€»æ•°
         * @returns {number} ç”¨æˆ·æ•°é‡
         */
        getUserCount() {
            return users.length;
        },
        
        /**
         * æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·
         */
        clearUsers() {
            users = []; // é‡æ–°èµ‹å€¼ï¼Œæ‰€ä»¥ä½¿ç”¨letè€Œä¸æ˜¯const
        }
    };
})();
```

#### é€‰æ‹©å»ºè®®å†³ç­–æ ‘

```
å˜é‡å£°æ˜é€‰æ‹©
â”œâ”€â”€ å€¼æ˜¯å¦ä¼šæ”¹å˜ï¼Ÿ
â”‚   â”œâ”€â”€ å¦ â†’ const
â”‚   â””â”€â”€ æ˜¯ â†“
â”œâ”€â”€ æ˜¯å¦éœ€è¦å—çº§ä½œç”¨åŸŸï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ let
â”‚   â””â”€â”€ å¦ â†“
â”œâ”€â”€ æ˜¯å¦åœ¨é—ç•™ä»£ç ä¸­ï¼Ÿ
â”‚   â”œâ”€â”€ æ˜¯ â†’ è€ƒè™‘varï¼ˆä½†æ¨èé‡æ„ä¸ºlet/constï¼‰
â”‚   â””â”€â”€ å¦ â†’ let

æ¨èä¼˜å…ˆçº§ï¼šconst > let > var
```

#### æ€§èƒ½è€ƒè™‘

```javascript
/**
 * æ€§èƒ½æµ‹è¯•ï¼šä¸åŒå£°æ˜æ–¹å¼çš„å½±å“
 */
function performanceComparison() {
    const iterations = 1000000;
    
    // æµ‹è¯•const
    console.time('constæ€§èƒ½æµ‹è¯•');
    for (let i = 0; i < iterations; i++) {
        const value = i * 2;
    }
    console.timeEnd('constæ€§èƒ½æµ‹è¯•');
    
    // æµ‹è¯•let
    console.time('letæ€§èƒ½æµ‹è¯•');
    for (let i = 0; i < iterations; i++) {
        let value = i * 2;
        value = value + 1; // é‡æ–°èµ‹å€¼
    }
    console.timeEnd('letæ€§èƒ½æµ‹è¯•');
    
    // æµ‹è¯•var
    console.time('varæ€§èƒ½æµ‹è¯•');
    for (var i = 0; i < iterations; i++) {
        var value = i * 2;
        value = value + 1;
    }
    console.timeEnd('varæ€§èƒ½æµ‹è¯•');
}

// åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ€§èƒ½å·®å¼‚é€šå¸¸å¯ä»¥å¿½ç•¥
// æ›´é‡è¦çš„æ˜¯ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
performanceComparison();
```

---

## 4.2 ä½œç”¨åŸŸï¼šå…¨å±€ã€å‡½æ•°ã€å—çº§

### ä½œç”¨åŸŸçš„æ¦‚å¿µ

ä½œç”¨åŸŸï¼ˆScopeï¼‰å†³å®šäº†å˜é‡å’Œå‡½æ•°çš„å¯è®¿é—®æ€§ã€‚JavaScriptä¸­æœ‰ä¸‰ç§ä¸»è¦çš„ä½œç”¨åŸŸï¼š

```
JavaScriptä½œç”¨åŸŸå±‚æ¬¡
â”œâ”€â”€ å…¨å±€ä½œç”¨åŸŸ (Global Scope)
â”‚   â”œâ”€â”€ å‡½æ•°ä½œç”¨åŸŸ (Function Scope)
â”‚   â”‚   â”œâ”€â”€ å—çº§ä½œç”¨åŸŸ (Block Scope)
â”‚   â”‚   â””â”€â”€ å—çº§ä½œç”¨åŸŸ (Block Scope)
â”‚   â””â”€â”€ å‡½æ•°ä½œç”¨åŸŸ (Function Scope)
â””â”€â”€ æ¨¡å—ä½œç”¨åŸŸ (Module Scope)
```

### å…¨å±€ä½œç”¨åŸŸ

å…¨å±€ä½œç”¨åŸŸæ˜¯æœ€å¤–å±‚çš„ä½œç”¨åŸŸï¼Œåœ¨å…¨å±€ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡å¯ä»¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹è®¿é—®ï¼š

#### 1. æµè§ˆå™¨ç¯å¢ƒä¸­çš„å…¨å±€ä½œç”¨åŸŸ

```javascript
// å…¨å±€å˜é‡å£°æ˜
var globalVar = 'I am global with var';
let globalLet = 'I am global with let';  
const globalConst = 'I am global with const';

// å‡½æ•°å£°æ˜ä¹Ÿæ˜¯å…¨å±€çš„
function globalFunction() {
    return 'I am a global function';
}

// åœ¨æµè§ˆå™¨ä¸­ï¼Œvarå£°æ˜çš„å…¨å±€å˜é‡ä¼šæˆä¸ºwindowå¯¹è±¡çš„å±æ€§
console.log(window.globalVar); // è¾“å‡º: I am global with var
console.log(window.globalLet); // è¾“å‡º: undefined
console.log(window.globalConst); // è¾“å‡º: undefined

/**
 * æ£€æŸ¥å…¨å±€å˜é‡çš„å‡½æ•°
 * @param {string} varName - å˜é‡åç§°
 */
function checkGlobalVariable(varName) {
    if (varName in window) {
        console.log(`${varName} æ˜¯windowå¯¹è±¡çš„å±æ€§`);
    } else {
        console.log(`${varName} ä¸æ˜¯windowå¯¹è±¡çš„å±æ€§`);
    }
}

checkGlobalVariable('globalVar');   // æ˜¯windowå¯¹è±¡çš„å±æ€§
checkGlobalVariable('globalLet');   // ä¸æ˜¯windowå¯¹è±¡çš„å±æ€§
checkGlobalVariable('globalConst'); // ä¸æ˜¯windowå¯¹è±¡çš„å±æ€§
```

#### 2. æ„å¤–çš„å…¨å±€å˜é‡

```javascript
function createAccidentalGlobal() {
    // âŒ å¿˜è®°å£°æ˜å˜é‡ï¼Œåˆ›å»ºäº†æ„å¤–çš„å…¨å±€å˜é‡
    accidentalGlobal = 'Oops, I am global!';
    
    // âœ… æ­£ç¡®çš„å±€éƒ¨å˜é‡å£°æ˜
    let properLocal = 'I am properly local';
}

createAccidentalGlobal();

console.log(window.accidentalGlobal); // è¾“å‡º: Oops, I am global!
// console.log(properLocal); // ReferenceError: properLocal is not defined

/**
 * ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é¿å…æ„å¤–å…¨å±€å˜é‡
 */
function strictModeExample() {
    'use strict';
    
    // åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™ä¼šæŠ¥é”™
    // strictVar = 'This will throw an error'; // ReferenceError
    
    let properVariable = 'This is correct';
    return properVariable;
}
```

#### 3. å…¨å±€å‘½åç©ºé—´æ±¡æŸ“é—®é¢˜

```javascript
// âŒ æ±¡æŸ“å…¨å±€å‘½åç©ºé—´çš„é—®é¢˜
var name = 'John';
var age = 25;
var email = 'john@example.com';

function updateProfile() {
    // å…¨å±€å˜é‡å¯èƒ½è¢«æ„å¤–ä¿®æ”¹
}

function resetData() {
    // å¯èƒ½å½±å“å…¶ä»–æ¨¡å—çš„å…¨å±€å˜é‡
}

// âœ… ä½¿ç”¨å‘½åç©ºé—´æ¨¡å¼é¿å…æ±¡æŸ“
const MyApp = {
    user: {
        name: 'John',
        age: 25,
        email: 'john@example.com'
    },
    
    /**
     * æ›´æ–°ç”¨æˆ·èµ„æ–™
     * @param {Object} newData - æ–°çš„ç”¨æˆ·æ•°æ®
     */
    updateProfile(newData) {
        Object.assign(this.user, newData);
    },
    
    /**
     * é‡ç½®ç”¨æˆ·æ•°æ®
     */
    resetData() {
        this.user = {
            name: '',
            age: 0,
            email: ''
        };
    }
};

// ä½¿ç”¨å‘½åç©ºé—´
MyApp.updateProfile({ age: 26 });
console.log(MyApp.user.age); // è¾“å‡º: 26
```

### å‡½æ•°ä½œç”¨åŸŸ

æ¯ä¸ªå‡½æ•°éƒ½åˆ›å»ºè‡ªå·±çš„ä½œç”¨åŸŸï¼Œå‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡åªåœ¨å‡½æ•°å†…éƒ¨å¯è®¿é—®ï¼š

#### 1. åŸºæœ¬å‡½æ•°ä½œç”¨åŸŸ

```javascript
function functionScopeExample() {
    var functionVar = 'I am function scoped';
    let functionLet = 'I am also function scoped';
    const functionConst = 'I am function scoped too';
    
    console.log(functionVar);   // å¯è®¿é—®
    console.log(functionLet);   // å¯è®¿é—®
    console.log(functionConst); // å¯è®¿é—®
    
    /**
     * åµŒå¥—å‡½æ•°å¯ä»¥è®¿é—®å¤–å±‚å‡½æ•°çš„å˜é‡
     */
    function innerFunction() {
        console.log('å†…å±‚å‡½æ•°è®¿é—®:', functionVar);
        
        // å†…å±‚å‡½æ•°çš„å˜é‡
        let innerVariable = 'I am in inner function';
        
        /**
         * æ›´æ·±å±‚çš„åµŒå¥—
         */
        function deeperFunction() {
            console.log('æ›´æ·±å±‚è®¿é—®:', innerVariable);
            console.log('æ›´æ·±å±‚è®¿é—®å¤–å±‚:', functionVar);
        }
        
        deeperFunction();
    }
    
    innerFunction();
    
    // console.log(innerVariable); // ReferenceError: innerVariable is not defined
}

functionScopeExample();

// console.log(functionVar); // ReferenceError: functionVar is not defined
```

#### 2. å‚æ•°ä½œç”¨åŸŸ

```javascript
/**
 * å‡½æ•°å‚æ•°ä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨åŸŸ
 * @param {string} param1 - ç¬¬ä¸€ä¸ªå‚æ•°
 * @param {number} param2 - ç¬¬äºŒä¸ªå‚æ•°  
 */
function parameterScope(param1, param2 = 'default value') {
    console.log('å‚æ•°1:', param1);
    console.log('å‚æ•°2:', param2);
    
    // å‚æ•°å¯ä»¥è¢«é‡æ–°èµ‹å€¼ï¼ˆä¸æ¨èï¼‰
    param1 = 'modified';
    console.log('ä¿®æ”¹åçš„å‚æ•°1:', param1);
    
    // å‚æ•°åªåœ¨å‡½æ•°å†…éƒ¨æœ‰æ•ˆ
    let localVar = param1 + param2;
    return localVar;
}

let result = parameterScope('hello', 'world');
console.log(result); // è¾“å‡º: modifiedworld

// console.log(param1); // ReferenceError: param1 is not defined
```

#### 3. ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆIIFEï¼‰

```javascript
/**
 * ä½¿ç”¨IIFEåˆ›å»ºç‹¬ç«‹çš„å‡½æ•°ä½œç”¨åŸŸ
 */
(function() {
    var privateVar = 'I am private';
    let privateLet = 'I am also private';
    
    console.log('IIFEå†…éƒ¨:', privateVar);
    
    // å¯ä»¥å‘å¤–éƒ¨æš´éœ²æ¥å£
    window.MyModule = {
        /**
         * è·å–ç§æœ‰å˜é‡çš„å…¬å…±æ–¹æ³•
         * @returns {string} ç§æœ‰å˜é‡çš„å€¼
         */
        getPrivateVar() {
            return privateVar;
        },
        
        /**
         * ä¿®æ”¹ç§æœ‰å˜é‡
         * @param {string} newValue - æ–°å€¼
         */
        setPrivateVar(newValue) {
            privateVar = newValue;
        }
    };
})();

// å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®ç§æœ‰å˜é‡
// console.log(privateVar); // ReferenceError

// ä½†å¯ä»¥é€šè¿‡æš´éœ²çš„æ¥å£è®¿é—®
console.log(MyModule.getPrivateVar()); // è¾“å‡º: I am private
MyModule.setPrivateVar('Modified private value');
console.log(MyModule.getPrivateVar()); // è¾“å‡º: Modified private value
```

### å—çº§ä½œç”¨åŸŸ

ES6å¼•å…¥çš„`let`å’Œ`const`æ”¯æŒå—çº§ä½œç”¨åŸŸï¼Œç”±`{}`åŒ…å›´çš„åŒºåŸŸå½¢æˆä¸€ä¸ªå—ï¼š

#### 1. åŸºæœ¬å—çº§ä½œç”¨åŸŸ

```javascript
{
    let blockLet = 'I am block scoped';
    const blockConst = 'I am also block scoped';
    var blockVar = 'I am NOT block scoped'; // varä¸æ”¯æŒå—çº§ä½œç”¨åŸŸ
    
    console.log('å—å†…è®¿é—®let:', blockLet);
    console.log('å—å†…è®¿é—®const:', blockConst);
    console.log('å—å†…è®¿é—®var:', blockVar);
}

// console.log(blockLet);   // ReferenceError: blockLet is not defined
// console.log(blockConst); // ReferenceError: blockConst is not defined
console.log(blockVar);      // è¾“å‡º: I am NOT block scoped

/**
 * ifè¯­å¥çš„å—çº§ä½œç”¨åŸŸ
 */
function blockScopeInIf() {
    if (true) {
        let ifLet = 'I am in if block';
        const ifConst = 'I am also in if block';
        var ifVar = 'I am function scoped from if';
        
        console.log('ifå—å†…:', ifLet, ifConst, ifVar);
    }
    
    // console.log(ifLet);   // ReferenceError
    // console.log(ifConst); // ReferenceError
    console.log(ifVar);      // å¯ä»¥è®¿é—®ï¼Œå› ä¸ºvaræ˜¯å‡½æ•°ä½œç”¨åŸŸ
}

blockScopeInIf();
```

#### 2. å¾ªç¯ä¸­çš„å—çº§ä½œç”¨åŸŸ

```javascript
/**
 * forå¾ªç¯çš„å—çº§ä½œç”¨åŸŸ
 */
function loopBlockScope() {
    console.log('=== letåœ¨å¾ªç¯ä¸­çš„è¡¨ç° ===');
    
    // letåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­éƒ½åˆ›å»ºæ–°çš„ç»‘å®š
    for (let i = 0; i < 3; i++) {
        setTimeout(() => {
            console.log('letå¾ªç¯ç´¢å¼•:', i); // è¾“å‡º: 0, 1, 2
        }, i * 100);
    }
    
    console.log('=== varåœ¨å¾ªç¯ä¸­çš„è¡¨ç° ===');
    
    // varåœ¨æ•´ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­åªæœ‰ä¸€ä¸ªç»‘å®š
    for (var j = 0; j < 3; j++) {
        setTimeout(() => {
            console.log('varå¾ªç¯ç´¢å¼•:', j); // è¾“å‡º: 3, 3, 3
        }, j * 100 + 350);
    }
    
    // console.log(i); // ReferenceError: i is not defined
    console.log('jåœ¨å¾ªç¯å¤–:', j); // è¾“å‡º: 3
}

loopBlockScope();

/**
 * forEachä¸­çš„ä½œç”¨åŸŸ
 */
function forEachScope() {
    const items = ['a', 'b', 'c'];
    
    items.forEach((item, index) => {
        // æ¯ä¸ªå›è°ƒå‡½æ•°éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ
        let processedItem = `å¤„ç†åçš„${item}`;
        
        setTimeout(() => {
            console.log(`ç´¢å¼•${index}: ${processedItem}`);
        }, index * 100);
    });
}

forEachScope();
```

#### 3. Switchè¯­å¥çš„å—çº§ä½œç”¨åŸŸé™·é˜±

```javascript
/**
 * switchè¯­å¥ä¸­çš„ä½œç”¨åŸŸé—®é¢˜
 */
function switchScopeIssue(value) {
    switch (value) {
        case 1:
            let message = 'Case 1'; // è¿™ä¸ªletå£°æ˜åœ¨æ•´ä¸ªswitchå—ä¸­
            console.log(message);
            break;
            
        case 2:
            // let message = 'Case 2'; // SyntaxError: é‡å¤å£°æ˜
            message = 'Case 2'; // åªèƒ½é‡æ–°èµ‹å€¼
            console.log(message);
            break;
            
        default:
            console.log('Default case');
    }
}

/**
 * æ­£ç¡®çš„switchå—çº§ä½œç”¨åŸŸå¤„ç†
 */
function switchScopeSolution(value) {
    switch (value) {
        case 1: {
            // ä½¿ç”¨èŠ±æ‹¬å·åˆ›å»ºç‹¬ç«‹çš„å—çº§ä½œç”¨åŸŸ
            let message = 'Case 1';
            console.log(message);
            break;
        }
        
        case 2: {
            // ç°åœ¨å¯ä»¥é‡æ–°å£°æ˜äº†
            let message = 'Case 2';
            console.log(message);
            break;
        }
        
        default: {
            let message = 'Default case';
            console.log(message);
        }
    }
}

switchScopeSolution(1); // è¾“å‡º: Case 1
switchScopeSolution(2); // è¾“å‡º: Case 2
```

### ä½œç”¨åŸŸé“¾

JavaScriptå¼•æ“é€šè¿‡ä½œç”¨åŸŸé“¾æ¥æŸ¥æ‰¾å˜é‡ï¼Œä»å½“å‰ä½œç”¨åŸŸå¼€å§‹ï¼Œå‘å¤–å±‚ä½œç”¨åŸŸæŸ¥æ‰¾ï¼š

#### 1. ä½œç”¨åŸŸé“¾æœºåˆ¶

```javascript
let globalVar = 'Global';

function outerFunction() {
    let outerVar = 'Outer';
    
    function middleFunction() {
        let middleVar = 'Middle';
        
        function innerFunction() {
            let innerVar = 'Inner';
            
            // ä½œç”¨åŸŸé“¾æŸ¥æ‰¾é¡ºåºï¼š
            // 1. innerFunctionä½œç”¨åŸŸ
            // 2. middleFunctionä½œç”¨åŸŸ  
            // 3. outerFunctionä½œç”¨åŸŸ
            // 4. å…¨å±€ä½œç”¨åŸŸ
            
            console.log(innerVar);  // å½“å‰ä½œç”¨åŸŸ
            console.log(middleVar); // å‘ä¸ŠæŸ¥æ‰¾
            console.log(outerVar);  // ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾
            console.log(globalVar); // å…¨å±€ä½œç”¨åŸŸæŸ¥æ‰¾
            
            /**
             * ä½œç”¨åŸŸé“¾å¯è§†åŒ–å‡½æ•°
             */
            function visualizeScopeChain() {
                console.log('=== ä½œç”¨åŸŸé“¾å¯è§†åŒ– ===');
                console.log('1. innerFunction -> innerVar:', innerVar);
                console.log('2. middleFunction -> middleVar:', middleVar);
                console.log('3. outerFunction -> outerVar:', outerVar);
                console.log('4. Global -> globalVar:', globalVar);
            }
            
            visualizeScopeChain();
        }
        
        return innerFunction;
    }
    
    return middleFunction;
}

const innerFunc = outerFunction()();
innerFunc();
```

#### 2. ä½œç”¨åŸŸé“¾ä¸é—­åŒ…

```javascript
/**
 * é—­åŒ…ä¿æŒå¯¹å¤–å±‚ä½œç”¨åŸŸçš„å¼•ç”¨
 */
function createCounter() {
    let count = 0;
    
    return {
        /**
         * å¢åŠ è®¡æ•°å™¨
         * @returns {number} å½“å‰è®¡æ•°
         */
        increment() {
            return ++count;
        },
        
        /**
         * è·å–å½“å‰è®¡æ•°
         * @returns {number} å½“å‰è®¡æ•°
         */
        getCount() {
            return count;
        },
        
        /**
         * é‡ç½®è®¡æ•°å™¨
         */
        reset() {
            count = 0;
        }
    };
}

const counter1 = createCounter();
const counter2 = createCounter();

console.log(counter1.increment()); // è¾“å‡º: 1
console.log(counter1.increment()); // è¾“å‡º: 2
console.log(counter2.increment()); // è¾“å‡º: 1 (ç‹¬ç«‹çš„ä½œç”¨åŸŸ)

console.log(counter1.getCount()); // è¾“å‡º: 2
console.log(counter2.getCount()); // è¾“å‡º: 1
```

#### 3. ä½œç”¨åŸŸæ€§èƒ½ä¼˜åŒ–

```javascript
/**
 * ä½œç”¨åŸŸé“¾é•¿åº¦å¯¹æ€§èƒ½çš„å½±å“
 */
function scopePerformanceTest() {
    let globalLookup = window.console; // ç¼“å­˜å…¨å±€å˜é‡
    
    function deeplyNested() {
        function level1() {
            function level2() {
                function level3() {
                    function level4() {
                        // âŒ æ¯æ¬¡éƒ½è¦æŸ¥æ‰¾æ•´ä¸ªä½œç”¨åŸŸé“¾
                        for (let i = 0; i < 10000; i++) {
                            console.log('Deep lookup');
                        }
                    }
                    level4();
                }
                level3();
            }
            level2();
        }
        level1();
    }
    
    function optimizedVersion() {
        const log = console.log; // ç¼“å­˜åˆ°å±€éƒ¨å˜é‡
        
        function level1() {
            function level2() {
                function level3() {
                    function level4() {
                        // âœ… ä½¿ç”¨å±€éƒ¨ç¼“å­˜ï¼Œé¿å…é‡å¤æŸ¥æ‰¾
                        for (let i = 0; i < 10000; i++) {
                            log('Optimized lookup');
                        }
                    }
                    level4();
                }
                level3();
            }
            level2();
        }
        level1();
    }
    
    // æ€§èƒ½æµ‹è¯•
    console.time('æ·±å±‚ä½œç”¨åŸŸæŸ¥æ‰¾');
    // deeplyNested(); // å–æ¶ˆæ³¨é‡Šè¿›è¡Œæµ‹è¯•
    console.timeEnd('æ·±å±‚ä½œç”¨åŸŸæŸ¥æ‰¾');
    
    console.time('ä¼˜åŒ–åçš„æŸ¥æ‰¾');  
    // optimizedVersion(); // å–æ¶ˆæ³¨é‡Šè¿›è¡Œæµ‹è¯•
    console.timeEnd('ä¼˜åŒ–åçš„æŸ¥æ‰¾');
}

---

## 4.3 å˜é‡æå‡ä¸æš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰

### å˜é‡æå‡æœºåˆ¶

å˜é‡æå‡ï¼ˆHoistingï¼‰æ˜¯JavaScriptçš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯å˜é‡å’Œå‡½æ•°å£°æ˜åœ¨ç¼–è¯‘é˜¶æ®µè¢«ç§»åŠ¨åˆ°å…¶æ‰€åœ¨ä½œç”¨åŸŸçš„é¡¶éƒ¨ã€‚

#### æå‡çš„æœ¬è´¨

```javascript
// ä»£ç ç¼–å†™æ—¶çš„æ ·å­
console.log(hoistedVar); // è¾“å‡º: undefined
var hoistedVar = 'I am hoisted';

// JavaScriptå¼•æ“å®é™…æ‰§è¡Œæ—¶çš„ç†è§£
var hoistedVar; // å£°æ˜è¢«æå‡
console.log(hoistedVar); // undefined
hoistedVar = 'I am hoisted'; // èµ‹å€¼ç•™åœ¨åŸä½ç½®
```

### varçš„æå‡è¡Œä¸º

`var`å£°æ˜ä¼šè¢«æå‡åˆ°å…¶ä½œç”¨åŸŸçš„é¡¶éƒ¨ï¼Œä½†åªæœ‰å£°æ˜è¢«æå‡ï¼Œèµ‹å€¼ä¸ä¼šï¼š

```javascript
/**
 * varæå‡ç¤ºä¾‹
 */
function varHoistingExample() {
    console.log('å˜é‡a:', a); // è¾“å‡º: undefined (è€Œä¸æ˜¯æŠ¥é”™)
    
    if (true) {
        var a = 'Hello';
        console.log('å—å†…å˜é‡a:', a); // è¾“å‡º: Hello
    }
    
    console.log('å—å¤–å˜é‡a:', a); // è¾“å‡º: Hello
    
    // å®é™…ä¸Šç­‰åŒäºï¼š
    // var a;
    // console.log('å˜é‡a:', a);
    // if (true) {
    //     a = 'Hello';
    //     console.log('å—å†…å˜é‡a:', a);
    // }
    // console.log('å—å¤–å˜é‡a:', a);
}

varHoistingExample();
```

### letå’Œconstçš„æš‚æ—¶æ€§æ­»åŒº

ES6çš„`let`å’Œ`const`ä¹Ÿä¼šè¢«æå‡ï¼Œä½†å®ƒä»¬æœ‰"æš‚æ—¶æ€§æ­»åŒº"ï¼ˆTemporal Dead Zone, TDZï¼‰ï¼š

```javascript
/**
 * æš‚æ—¶æ€§æ­»åŒºç¤ºä¾‹
 */
function temporalDeadZoneExample() {
    console.log('è¿›å…¥å‡½æ•°ä½œç”¨åŸŸ');
    
    // è¿™é‡Œæ˜¯TDZå¼€å§‹
    // console.log(letVar); // ReferenceError: Cannot access 'letVar' before initialization
    // console.log(constVar); // ReferenceError: Cannot access 'constVar' before initialization
    
    let letVar = 'I am let';     // TDZç»“æŸ
    const constVar = 'I am const'; // TDZç»“æŸ
    
    console.log(letVar);   // è¾“å‡º: I am let
    console.log(constVar); // è¾“å‡º: I am const
}

temporalDeadZoneExample();

/**
 * å¤æ‚çš„TDZåœºæ™¯
 */
function complexTDZ() {
    let x = 1;
    
    function innerFunction() {
        // å†…éƒ¨çš„xå£°æ˜åˆ›å»ºäº†TDZï¼Œå±è”½äº†å¤–éƒ¨çš„x
        console.log(x); // ReferenceError: Cannot access 'x' before initialization
        let x = 2;
    }
    
    innerFunction();
}

// complexTDZ(); // å–æ¶ˆæ³¨é‡Šä¼šæŠ¥é”™
```

### å‡½æ•°æå‡

å‡½æ•°å£°æ˜ä¼šå®Œå…¨æå‡ï¼ˆåŒ…æ‹¬å‡½æ•°ä½“ï¼‰ï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ä¸ä¼šï¼š

```javascript
/**
 * å‡½æ•°æå‡å¯¹æ¯”
 */
console.log('=== å‡½æ•°å£°æ˜æå‡ ===');
console.log(declaredFunction()); // è¾“å‡º: I am a declared function

function declaredFunction() {
    return 'I am a declared function';
}

console.log('=== å‡½æ•°è¡¨è¾¾å¼ä¸æå‡ ===');
// console.log(expressionFunction()); // TypeError: expressionFunction is not a function

var expressionFunction = function() {
    return 'I am a function expression';
};

console.log(expressionFunction()); // è¾“å‡º: I am a function expression

/**
 * ç®­å¤´å‡½æ•°ä¹Ÿä¸ä¼šæå‡
 */
// console.log(arrowFunction()); // ReferenceError: Cannot access 'arrowFunction' before initialization

const arrowFunction = () => {
    return 'I am an arrow function';
};

console.log(arrowFunction()); // è¾“å‡º: I am an arrow function
```

---

## 4.4 æœ€ä½³å®è·µä¸ä»£ç é£æ ¼

### ç°ä»£JavaScriptå˜é‡å£°æ˜è§„èŒƒ

#### 1. ä¼˜å…ˆçº§åŸåˆ™ï¼šconst > let > var

```javascript
// âœ… æ¨èçš„å£°æ˜ä¼˜å…ˆçº§
const CONFIG = { api: '/api/v1' };     // ä¼˜å…ˆä½¿ç”¨const
let counter = 0;                       // éœ€è¦é‡æ–°èµ‹å€¼æ—¶ä½¿ç”¨let
// var legacy;                         // é¿å…ä½¿ç”¨varï¼ˆé™¤éç»´æŠ¤è€ä»£ç ï¼‰

/**
 * å®é™…åº”ç”¨ç¤ºä¾‹
 */
function bestPracticeExample() {
    // å¸¸é‡é…ç½®
    const MAX_RETRY = 3;
    const API_ENDPOINTS = {
        users: '/users',
        posts: '/posts'
    };
    
    // å¯å˜å˜é‡
    let currentRetry = 0;
    let isLoading = false;
    
    // å‡½æ•°å†…çš„å±€éƒ¨å¸¸é‡
    const processData = (data) => {
        const timestamp = Date.now();
        return { ...data, timestamp };
    };
    
    return { MAX_RETRY, currentRetry, processData };
}
```

#### 2. å—çº§ä½œç”¨åŸŸä¼˜å…ˆ

```javascript
// âœ… åˆ©ç”¨å—çº§ä½œç”¨åŸŸç»„ç»‡ä»£ç 
function processItems(items) {
    const results = [];
    
    // å¤„ç†æœ‰æ•ˆé¡¹ç›®
    {
        const validItems = items.filter(item => item && item.id);
        const processedItems = validItems.map(item => ({
            id: item.id,
            name: item.name || 'Unknown',
            processed: true
        }));
        results.push(...processedItems);
    }
    
    // å¤„ç†æ— æ•ˆé¡¹ç›®
    {
        const invalidItems = items.filter(item => !item || !item.id);
        const errorItems = invalidItems.map((item, index) => ({
            error: 'Invalid item',
            index,
            original: item
        }));
        results.push(...errorItems);
    }
    
    return results;
}
```

### å‘½åçº¦å®š

#### 1. å˜é‡å‘½åè§„åˆ™

```javascript
// âœ… å¥½çš„å‘½åçº¦å®š
const USER_ROLES = ['admin', 'user', 'guest'];           // å¸¸é‡ä½¿ç”¨å¤§å†™
const maxFileSize = 10 * 1024 * 1024;                   // é©¼å³°å‘½å
const isAuthenticated = false;                           // å¸ƒå°”å€¼ä½¿ç”¨is/haså‰ç¼€
const userList = [];                                     // æ•°ç»„ä½¿ç”¨å¤æ•°æˆ–Liståç¼€
const userMap = new Map();                               // Mapä½¿ç”¨Mapåç¼€

// âŒ é¿å…çš„å‘½åæ–¹å¼
const data = {};           // å¤ªæ¨¡ç³Š
const temp = 'value';      // ä¸´æ—¶å˜é‡åä¸æ˜ç¡®
const a = 10;              // å•å­—æ¯å˜é‡å
const UsErNaMe = 'John';   // ä¸ä¸€è‡´çš„å‘½åé£æ ¼

/**
 * å‡½æ•°å’Œæ–¹æ³•å‘½å
 */
const UserService = {
    // åŠ¨è¯å¼€å¤´ï¼Œè¡¨è¾¾è¡Œä¸º
    createUser(userData) { /* ... */ },
    deleteUser(userId) { /* ... */ },
    
    // è·å–æ•°æ®ä½¿ç”¨getå‰ç¼€
    getUserById(id) { /* ... */ },
    getUserList() { /* ... */ },
    
    // éªŒè¯åŠŸèƒ½ä½¿ç”¨validate/checkå‰ç¼€
    validateUserData(data) { /* ... */ },
    checkUserPermission(userId, permission) { /* ... */ },
    
    // å¸ƒå°”è¿”å›å€¼ä½¿ç”¨is/has/canå‰ç¼€
    isUserActive(userId) { /* ... */ },
    hasPermission(userId, permission) { /* ... */ },
    canUserAccess(userId, resource) { /* ... */ }
};
```

#### 2. ç‰¹æ®Šåœºæ™¯å‘½å

```javascript
/**
 * ç§æœ‰å˜é‡å’Œæ–¹æ³•ï¼ˆçº¦å®šä½¿ç”¨ä¸‹åˆ’çº¿å‰ç¼€ï¼‰
 */
class DataProcessor {
    constructor() {
        this._cache = new Map();          // ç§æœ‰å±æ€§
        this._maxCacheSize = 100;         // ç§æœ‰å¸¸é‡
    }
    
    // å…¬å…±æ–¹æ³•
    processData(data) {
        return this._validateAndProcess(data);
    }
    
    // ç§æœ‰æ–¹æ³•
    _validateAndProcess(data) {
        if (this._isValidData(data)) {
            return this._processValidData(data);
        }
        throw new Error('Invalid data');
    }
    
    _isValidData(data) { /* ... */ }
    _processValidData(data) { /* ... */ }
}

/**
 * äº‹ä»¶å¤„ç†å‡½æ•°å‘½å
 */
const EventHandlers = {
    // handle + äº‹ä»¶å
    handleButtonClick(event) { /* ... */ },
    handleInputChange(event) { /* ... */ },
    handleFormSubmit(event) { /* ... */ },
    
    // on + äº‹ä»¶åï¼ˆå›è°ƒå‡½æ•°ï¼‰
    onUserLogin(userData) { /* ... */ },
    onDataLoaded(data) { /* ... */ },
    onError(error) { /* ... */ }
};
```

### ä»£ç ç»„ç»‡å»ºè®®

#### 1. å˜é‡å£°æ˜ç»„ç»‡

```javascript
/**
 * æ¨èçš„å˜é‡å£°æ˜ç»„ç»‡æ–¹å¼
 */
function wellOrganizedFunction(params) {
    // 1. å¸¸é‡é…ç½®ï¼ˆé¡¶éƒ¨ï¼‰
    const DEFAULT_TIMEOUT = 5000;
    const VALID_STATUSES = ['active', 'pending', 'inactive'];
    
    // 2. è§£æ„å‚æ•°
    const { userId, options = {} } = params;
    const { timeout = DEFAULT_TIMEOUT, retries = 3 } = options;
    
    // 3. åˆå§‹åŒ–å˜é‡
    let currentRetry = 0;
    let lastError = null;
    let result = null;
    
    // 4. å¤æ‚å¯¹è±¡æ„é€ 
    const requestConfig = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${getAuthToken()}`
        },
        timeout
    };
    
    // 5. å‡½æ•°é€»è¾‘
    while (currentRetry < retries) {
        try {
            result = performRequest(requestConfig);
            break;
        } catch (error) {
            lastError = error;
            currentRetry++;
        }
    }
    
    return result || { error: lastError };
}
```

#### 2. æ¨¡å—çº§å˜é‡ç»„ç»‡

```javascript
// module-config.js - é…ç½®æ¨¡å—
export const APP_CONFIG = {
    API_BASE_URL: process.env.API_URL || 'http://localhost:3000',
    DEFAULT_TIMEOUT: 5000,
    MAX_RETRIES: 3
};

export const UI_CONSTANTS = {
    BREAKPOINTS: {
        mobile: '768px',
        tablet: '1024px',
        desktop: '1200px'
    },
    COLORS: {
        primary: '#007bff',
        secondary: '#6c757d',
        success: '#28a745'
    }
};

// user-service.js - æœåŠ¡æ¨¡å—
import { APP_CONFIG } from './module-config.js';

// æ¨¡å—çº§ç§æœ‰å˜é‡
let authToken = null;
let requestCache = new Map();

// å…¬å¼€çš„æœåŠ¡æ¥å£
export const UserService = {
    async login(credentials) {
        const response = await fetch(`${APP_CONFIG.API_BASE_URL}/auth/login`, {
            method: 'POST',
            body: JSON.stringify(credentials)
        });
        
        if (response.ok) {
            authToken = response.headers.get('Authorization');
        }
        
        return response;
    }
};
```

### å¸¸è§é™·é˜±ä¸é¿å…æ–¹æ³•

#### 1. å¾ªç¯ä¸­çš„å˜é‡ç»‘å®š

```javascript
// âŒ ç»å…¸é™·é˜±ï¼šå¾ªç¯ä¸­çš„var
function createButtonHandlers_Bad() {
    const buttons = document.querySelectorAll('.btn');
    
    for (var i = 0; i < buttons.length; i++) {
        buttons[i].onclick = function() {
            console.log('ç‚¹å‡»äº†æŒ‰é’®', i); // æ€»æ˜¯è¾“å‡ºæœ€åä¸€ä¸ªiçš„å€¼
        };
    }
}

// âœ… è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨let
function createButtonHandlers_Good1() {
    const buttons = document.querySelectorAll('.btn');
    
    for (let i = 0; i < buttons.length; i++) {
        buttons[i].onclick = function() {
            console.log('ç‚¹å‡»äº†æŒ‰é’®', i); // æ­£ç¡®è¾“å‡ºå¯¹åº”çš„iå€¼
        };
    }
}

// âœ… è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨forEach
function createButtonHandlers_Good2() {
    const buttons = document.querySelectorAll('.btn');
    
    buttons.forEach((button, index) => {
        button.onclick = () => {
            console.log('ç‚¹å‡»äº†æŒ‰é’®', index);
        };
    });
}
```

#### 2. æ„å¤–çš„å…¨å±€å˜é‡

```javascript
// âŒ æ„å¤–åˆ›å»ºå…¨å±€å˜é‡
function processData_Bad() {
    data = []; // å¿˜è®°å£°æ˜ï¼Œåˆ›å»ºäº†å…¨å±€å˜é‡
    
    for (item of items) { // å¿˜è®°å£°æ˜ï¼Œitemæˆä¸ºå…¨å±€å˜é‡
        data.push(processItem(item));
    }
    
    return data;
}

// âœ… æ­£ç¡®çš„å˜é‡å£°æ˜
function processData_Good() {
    'use strict'; // ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é˜²æ­¢æ„å¤–å…¨å±€å˜é‡
    
    const data = [];
    
    for (const item of items) {
        data.push(processItem(item));
    }
    
    return data;
}
```

#### 3. å˜é‡æå‡æ··æ·†

```javascript
// âŒ å®¹æ˜“æ··æ·†çš„å˜é‡æå‡
function confusingHoisting_Bad() {
    console.log(message); // undefinedï¼Œä»¤äººå›°æƒ‘
    
    if (false) {
        var message = 'This will never execute';
    }
    
    console.log(message); // ä»ç„¶æ˜¯undefined
}

// âœ… æ¸…æ™°çš„å˜é‡å£°æ˜
function clearDeclaration_Good() {
    let message;
    
    if (someCondition()) {
        message = 'Condition is true';
    } else {
        message = 'Condition is false';
    }
    
    console.log(message); // é€»è¾‘æ¸…æ™°
}
```

#### 4. constçš„è¯¯ç”¨

```javascript
// âŒ å¯¹constçš„è¯¯è§£
const users = [];
users = []; // TypeError: Assignment to constant variable

const config = { api: '/api/v1' };
config = {}; // TypeError: Assignment to constant variable

// âœ… æ­£ç¡®ä½¿ç”¨const
const users = [];
users.push({ id: 1, name: 'Alice' }); // âœ… å¯ä»¥ä¿®æ”¹æ•°ç»„å†…å®¹

const config = { api: '/api/v1' };
config.timeout = 5000; // âœ… å¯ä»¥ä¿®æ”¹å¯¹è±¡å±æ€§

// å¦‚éœ€çœŸæ­£ä¸å¯å˜ï¼Œä½¿ç”¨Object.freeze()
const immutableConfig = Object.freeze({
    api: '/api/v1',
    version: '1.0.0'
});
```

---

## æœ¬ç« æ€»ç»“

å˜é‡ä¸å¸¸é‡æ˜¯JavaScriptç¼–ç¨‹çš„åŸºç¡€ï¼Œç†è§£å®ƒä»¬çš„è¡Œä¸ºå¯¹å†™å‡ºé«˜è´¨é‡ä»£ç è‡³å…³é‡è¦ã€‚

### ğŸ¯ æ ¸å¿ƒçŸ¥è¯†ç‚¹

1. **ä¸‰ç§å£°æ˜æ–¹å¼**ï¼š`var`ï¼ˆå‡½æ•°ä½œç”¨åŸŸï¼‰ã€`let`ï¼ˆå—çº§ä½œç”¨åŸŸï¼‰ã€`const`ï¼ˆå¸¸é‡ï¼‰
2. **ä½œç”¨åŸŸç±»å‹**ï¼šå…¨å±€ä½œç”¨åŸŸã€å‡½æ•°ä½œç”¨åŸŸã€å—çº§ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾
3. **æå‡æœºåˆ¶**ï¼šå˜é‡æå‡ã€å‡½æ•°æå‡å’Œæš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰
4. **æœ€ä½³å®è·µ**ï¼šä¼˜å…ˆçº§åŸåˆ™ã€å‘½åè§„èŒƒã€ä»£ç ç»„ç»‡

### ğŸ“ˆ å…³é”®è¦ç‚¹

- **ä¼˜å…ˆçº§åŸåˆ™**ï¼šconst > let > varï¼Œä¼˜å…ˆä½¿ç”¨constå’Œlet
- **ä½œç”¨åŸŸæ§åˆ¶**ï¼šåˆç†åˆ©ç”¨å—çº§ä½œç”¨åŸŸç»„ç»‡ä»£ç é€»è¾‘
- **é¿å…é™·é˜±**ï¼šç†è§£æå‡æœºåˆ¶ï¼Œé¿å…å¾ªç¯ç»‘å®šç­‰å¸¸è§é—®é¢˜
- **å‘½åè§„èŒƒ**ï¼šé‡‡ç”¨ä¸€è‡´çš„å‘½åçº¦å®šï¼Œæé«˜ä»£ç å¯è¯»æ€§

### ğŸ’¡ å®è·µå»ºè®®

1. é»˜è®¤ä½¿ç”¨`const`ï¼Œéœ€è¦é‡æ–°èµ‹å€¼æ—¶ä½¿ç”¨`let`
2. é¿å…ä½¿ç”¨`var`ï¼Œé™¤éç»´æŠ¤é—ç•™ä»£ç 
3. åˆ©ç”¨å—çº§ä½œç”¨åŸŸç»„ç»‡ç›¸å…³ä»£ç 
4. é‡‡ç”¨æœ‰æ„ä¹‰çš„å˜é‡å‘½å
5. ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é˜²æ­¢æ„å¤–çš„å…¨å±€å˜é‡

---

**ä¸‹ä¸€ç« é¢„å‘Šï¼š** æˆ‘ä»¬å°†å­¦ä¹ JavaScriptçš„æ•°æ®ç±»å‹ä¸ç±»å‹ç³»ç»Ÿï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹ã€å¼•ç”¨ç±»å‹ã€ç±»å‹åˆ¤æ–­å’Œç±»å‹è½¬æ¢ç­‰é‡è¦æ¦‚å¿µã€‚
