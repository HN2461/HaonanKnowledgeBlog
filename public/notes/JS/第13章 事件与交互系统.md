# ç¬¬13ç« ã€€äº‹ä»¶ä¸äº¤äº’ç³»ç»Ÿ

äº‹ä»¶æ˜¯Webäº¤äº’çš„æ ¸å¿ƒæœºåˆ¶ï¼Œè®©ç½‘é¡µèƒ½å¤Ÿå“åº”ç”¨æˆ·çš„æ“ä½œå’Œç³»ç»ŸçŠ¶æ€å˜åŒ–ã€‚æœ¬ç« å°†æ·±å…¥å­¦ä¹ JavaScriptäº‹ä»¶ç³»ç»Ÿï¼Œä»åŸºç¡€çš„äº‹ä»¶ç›‘å¬åˆ°å¤æ‚çš„äº‹ä»¶ç®¡ç†æ¨¡å¼ï¼Œæ„å»ºçœŸæ­£åŠ¨æ€çš„ç”¨æˆ·ç•Œé¢ã€‚

## 13.1 äº‹ä»¶ç›‘å¬ï¼ˆaddEventListenerï¼‰

ç°ä»£JavaScriptäº‹ä»¶å¤„ç†çš„æ ‡å‡†æ–¹æ³•ã€‚

### åŸºç¡€äº‹ä»¶ç›‘å¬

æŒæ¡addEventListenerçš„æ ¸å¿ƒç”¨æ³•ï¼š

```javascript
/**
 * äº‹ä»¶ç›‘å¬åŸºç¡€ç¤ºä¾‹
 */
const EventListenerExamples = {
    /**
     * åŸºç¡€è¯­æ³•å’Œç”¨æ³•
     */
    basicUsage() {
        console.log('=== åŸºç¡€äº‹ä»¶ç›‘å¬ ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºæµ‹è¯•æŒ‰é’®
        const button = document.createElement('button');
        button.textContent = 'ç‚¹å‡»æˆ‘';
        button.id = 'test-button';
        document.body.appendChild(button);
        
        // 1. åŸºç¡€äº‹ä»¶ç›‘å¬
        button.addEventListener('click', function(event) {
            console.log('æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼');
            console.log('äº‹ä»¶ç±»å‹:', event.type);
            console.log('ç›®æ ‡å…ƒç´ :', event.target.tagName);
        });
        
        // 2. ä½¿ç”¨ç®­å¤´å‡½æ•°
        button.addEventListener('mouseenter', (event) => {
            console.log('é¼ æ ‡è¿›å…¥æŒ‰é’®');
            event.target.style.backgroundColor = 'lightblue';
        });
        
        button.addEventListener('mouseleave', (event) => {
            console.log('é¼ æ ‡ç¦»å¼€æŒ‰é’®');
            event.target.style.backgroundColor = '';
        });
        
        // 3. å‘½åå‡½æ•°çš„å¥½å¤„ï¼ˆå¯ä»¥ç§»é™¤ï¼‰
        function handleDoubleClick(event) {
            console.log('æŒ‰é’®è¢«åŒå‡»');
            console.log('åŒå‡»ä½ç½®:', event.clientX, event.clientY);
        }
        
        button.addEventListener('dblclick', handleDoubleClick);
        
        // 4. äº‹ä»¶ç›‘å¬é€‰é¡¹
        button.addEventListener('contextmenu', function(event) {
            console.log('å³é”®èœå•äº‹ä»¶');
            // event.preventDefault(); // é˜»æ­¢é»˜è®¤å³é”®èœå•
        }, {
            once: true,     // åªæ‰§è¡Œä¸€æ¬¡
            passive: false, // éè¢«åŠ¨ç›‘å¬
            capture: false  // å†’æ³¡é˜¶æ®µç›‘å¬
        });
        
        console.log('åŸºç¡€äº‹ä»¶ç›‘å¬å·²è®¾ç½®');
    },
    
    /**
     * äº‹ä»¶ç›‘å¬ç®¡ç†
     */
    eventManagement() {
        console.log('=== äº‹ä»¶ç›‘å¬ç®¡ç† ===');
        
        if (typeof document === 'undefined') return;
        
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'è¾“å…¥æ–‡æœ¬æµ‹è¯•';
        document.body.appendChild(input);
        
        // äº‹ä»¶å¤„ç†å‡½æ•°é›†åˆ
        const handlers = {
            focus: (event) => {
                console.log('è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹');
                event.target.style.borderColor = 'blue';
            },
            
            blur: (event) => {
                console.log('è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹');
                event.target.style.borderColor = '';
            },
            
            input: (event) => {
                console.log('è¾“å…¥å†…å®¹:', event.target.value);
            },
            
            keydown: (event) => {
                if (event.key === 'Enter') {
                    console.log('æŒ‰ä¸‹å›è½¦é”®');
                }
                if (event.key === 'Escape') {
                    event.target.value = '';
                    console.log('æ¸…ç©ºè¾“å…¥å†…å®¹');
                }
            }
        };
        
        // æ‰¹é‡æ·»åŠ äº‹ä»¶ç›‘å¬
        Object.keys(handlers).forEach(eventType => {
            input.addEventListener(eventType, handlers[eventType]);
        });
        
        // ç§»é™¤ç‰¹å®šäº‹ä»¶ç›‘å¬
        setTimeout(() => {
            input.removeEventListener('input', handlers.input);
            console.log('ç§»é™¤inputäº‹ä»¶ç›‘å¬');
        }, 10000);
        
        // äº‹ä»¶ç›‘å¬ç®¡ç†ç±»
        class EventManager {
            constructor() {
                this.listeners = new Map();
            }
            
            add(element, type, handler, options = {}) {
                const key = `${element.tagName}-${type}`;
                
                if (!this.listeners.has(key)) {
                    this.listeners.set(key, []);
                }
                
                this.listeners.get(key).push({ handler, options });
                element.addEventListener(type, handler, options);
            }
            
            remove(element, type, handler) {
                const key = `${element.tagName}-${type}`;
                const listeners = this.listeners.get(key);
                
                if (listeners) {
                    const index = listeners.findIndex(l => l.handler === handler);
                    if (index !== -1) {
                        listeners.splice(index, 1);
                        element.removeEventListener(type, handler);
                    }
                }
            }
            
            removeAll(element, type = null) {
                if (type) {
                    const key = `${element.tagName}-${type}`;
                    const listeners = this.listeners.get(key);
                    
                    if (listeners) {
                        listeners.forEach(({ handler }) => {
                            element.removeEventListener(type, handler);
                        });
                        this.listeners.delete(key);
                    }
                } else {
                    // ç§»é™¤å…ƒç´ çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬
                    for (let [key, listeners] of this.listeners) {
                        if (key.startsWith(element.tagName)) {
                            listeners.forEach(({ handler }) => {
                                const eventType = key.split('-')[1];
                                element.removeEventListener(eventType, handler);
                            });
                            this.listeners.delete(key);
                        }
                    }
                }
            }
            
            getListenerCount() {
                let count = 0;
                for (let listeners of this.listeners.values()) {
                    count += listeners.length;
                }
                return count;
            }
        }
        
        const eventManager = new EventManager();
        console.log('äº‹ä»¶ç®¡ç†å™¨å·²åˆ›å»ºï¼Œç›‘å¬å™¨æ•°é‡:', eventManager.getListenerCount());
    },
    
    /**
     * äº‹ä»¶å¯¹è±¡è¯¦è§£
     */
    eventObjectDetails() {
        console.log('=== äº‹ä»¶å¯¹è±¡è¯¦è§£ ===');
        
        if (typeof document === 'undefined') return;
        
        const div = document.createElement('div');
        div.style.cssText = `
            width: 200px;
            height: 100px;
            background: lightgray;
            border: 1px solid black;
            margin: 10px;
            padding: 10px;
            cursor: pointer;
        `;
        div.textContent = 'ç‚¹å‡»æµ‹è¯•åŒºåŸŸ';
        document.body.appendChild(div);
        
        div.addEventListener('click', function(event) {
            console.log('=== äº‹ä»¶å¯¹è±¡å±æ€§ ===');
            
            // åŸºæœ¬å±æ€§
            console.log('type:', event.type);
            console.log('target:', event.target.tagName);
            console.log('currentTarget:', event.currentTarget.tagName);
            console.log('eventPhase:', event.eventPhase);
            
            // é¼ æ ‡ä½ç½®
            console.log('clientX/Y:', event.clientX, event.clientY);
            console.log('pageX/Y:', event.pageX, event.pageY);
            console.log('screenX/Y:', event.screenX, event.screenY);
            console.log('offsetX/Y:', event.offsetX, event.offsetY);
            
            // ä¿®é¥°é”®
            console.log('ctrlKey:', event.ctrlKey);
            console.log('shiftKey:', event.shiftKey);
            console.log('altKey:', event.altKey);
            console.log('metaKey:', event.metaKey);
            
            // é¼ æ ‡æŒ‰é’®
            console.log('button:', event.button); // 0=å·¦é”®, 1=ä¸­é”®, 2=å³é”®
            console.log('buttons:', event.buttons); // æŒ‰ä½è¡¨ç¤º
            
            // æ—¶é—´æˆ³
            console.log('timeStamp:', event.timeStamp);
            
            // äº‹ä»¶çŠ¶æ€
            console.log('bubbles:', event.bubbles);
            console.log('cancelable:', event.cancelable);
            console.log('defaultPrevented:', event.defaultPrevented);
        });
        
        // è‡ªå®šä¹‰äº‹ä»¶
        const customEvent = new CustomEvent('customClick', {
            detail: { 
                message: 'è¿™æ˜¯è‡ªå®šä¹‰äº‹ä»¶',
                timestamp: Date.now()
            },
            bubbles: true,
            cancelable: true
        });
        
        div.addEventListener('customClick', function(event) {
            console.log('è‡ªå®šä¹‰äº‹ä»¶è§¦å‘:', event.detail);
        });
        
        // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
        setTimeout(() => {
            div.dispatchEvent(customEvent);
        }, 2000);
        
        console.log('äº‹ä»¶å¯¹è±¡è¯¦è§£è®¾ç½®å®Œæˆ');
    }
};

EventListenerExamples.basicUsage();
EventListenerExamples.eventManagement();
EventListenerExamples.eventObjectDetails();
```

### äº‹ä»¶ç±»å‹åˆ†ç±»

äº†è§£å„ç§DOMäº‹ä»¶ç±»å‹ï¼š

```javascript
/**
 * äº‹ä»¶ç±»å‹åˆ†ç±»ç¤ºä¾‹
 */
const EventTypesExamples = {
    /**
     * UIäº‹ä»¶
     */
    uiEvents() {
        console.log('=== UIäº‹ä»¶ ===');
        
        if (typeof document === 'undefined') return;
        
        // çª—å£äº‹ä»¶
        window.addEventListener('load', () => {
            console.log('é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ');
        });
        
        window.addEventListener('beforeunload', (event) => {
            console.log('é¡µé¢å³å°†å¸è½½');
            // event.returnValue = 'ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
        });
        
        window.addEventListener('resize', (event) => {
            console.log('çª—å£å¤§å°æ”¹å˜:', window.innerWidth, 'x', window.innerHeight);
        });
        
        window.addEventListener('scroll', (event) => {
            console.log('é¡µé¢æ»šåŠ¨:', window.pageXOffset, window.pageYOffset);
        });
        
        // æ–‡æ¡£äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMå†…å®¹åŠ è½½å®Œæˆ');
        });
        
        document.addEventListener('readystatechange', () => {
            console.log('æ–‡æ¡£çŠ¶æ€å˜åŒ–:', document.readyState);
        });
        
        console.log('UIäº‹ä»¶ç›‘å¬å·²è®¾ç½®');
    },
    
    /**
     * ç„¦ç‚¹äº‹ä»¶
     */
    focusEvents() {
        console.log('=== ç„¦ç‚¹äº‹ä»¶ ===');
        
        if (typeof document === 'undefined') return;
        
        const inputs = [];
        for (let i = 0; i < 3; i++) {
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `è¾“å…¥æ¡† ${i + 1}`;
            input.style.margin = '5px';
            
            // focus/blur ä¸å†’æ³¡
            input.addEventListener('focus', (event) => {
                console.log(`è¾“å…¥æ¡† ${i + 1} è·å¾—ç„¦ç‚¹`);
                event.target.style.backgroundColor = 'lightyellow';
            });
            
            input.addEventListener('blur', (event) => {
                console.log(`è¾“å…¥æ¡† ${i + 1} å¤±å»ç„¦ç‚¹`);
                event.target.style.backgroundColor = '';
            });
            
            // focusin/focusout å†’æ³¡
            input.addEventListener('focusin', (event) => {
                console.log(`ç„¦ç‚¹è¿›å…¥ ${i + 1} (å†’æ³¡)`);
            });
            
            input.addEventListener('focusout', (event) => {
                console.log(`ç„¦ç‚¹ç¦»å¼€ ${i + 1} (å†’æ³¡)`);
            });
            
            document.body.appendChild(input);
            inputs.push(input);
        }
        
        // ç„¦ç‚¹ç®¡ç†
        const focusManager = {
            currentIndex: -1,
            
            next() {
                this.currentIndex = (this.currentIndex + 1) % inputs.length;
                inputs[this.currentIndex].focus();
            },
            
            previous() {
                this.currentIndex = this.currentIndex <= 0 ? inputs.length - 1 : this.currentIndex - 1;
                inputs[this.currentIndex].focus();
            }
        };
        
        // æ·»åŠ å¯¼èˆªæŒ‰é’®
        const navDiv = document.createElement('div');
        navDiv.style.margin = '10px';
        
        const prevBtn = document.createElement('button');
        prevBtn.textContent = 'ä¸Šä¸€ä¸ª';
        prevBtn.addEventListener('click', () => focusManager.previous());
        
        const nextBtn = document.createElement('button');
        nextBtn.textContent = 'ä¸‹ä¸€ä¸ª';
        nextBtn.addEventListener('click', () => focusManager.next());
        
        navDiv.appendChild(prevBtn);
        navDiv.appendChild(nextBtn);
        document.body.appendChild(navDiv);
        
        console.log('ç„¦ç‚¹äº‹ä»¶ç¤ºä¾‹å·²è®¾ç½®');
    },
    
    /**
     * è®¾å¤‡äº‹ä»¶
     */
    deviceEvents() {
        console.log('=== è®¾å¤‡äº‹ä»¶ ===');
        
        if (typeof document === 'undefined') return;
        
        // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰
        const touchArea = document.createElement('div');
        touchArea.style.cssText = `
            width: 200px;
            height: 200px;
            background: lightcoral;
            margin: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        `;
        touchArea.textContent = 'è§¦æ‘¸åŒºåŸŸ';
        document.body.appendChild(touchArea);
        
        // è§¦æ‘¸äº‹ä»¶
        touchArea.addEventListener('touchstart', (event) => {
            console.log('è§¦æ‘¸å¼€å§‹ï¼Œè§¦ç‚¹æ•°:', event.touches.length);
            event.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º
        });
        
        touchArea.addEventListener('touchmove', (event) => {
            console.log('è§¦æ‘¸ç§»åŠ¨');
            event.preventDefault();
        });
        
        touchArea.addEventListener('touchend', (event) => {
            console.log('è§¦æ‘¸ç»“æŸ');
        });
        
        // æ‰‹åŠ¿äº‹ä»¶ï¼ˆWebkitï¼‰
        if ('ongesturestart' in touchArea) {
            touchArea.addEventListener('gesturestart', (event) => {
                console.log('æ‰‹åŠ¿å¼€å§‹');
            });
            
            touchArea.addEventListener('gesturechange', (event) => {
                console.log('æ‰‹åŠ¿å˜åŒ–ï¼Œç¼©æ”¾:', event.scale, 'æ—‹è½¬:', event.rotation);
            });
            
            touchArea.addEventListener('gestureend', (event) => {
                console.log('æ‰‹åŠ¿ç»“æŸ');
            });
        }
        
        // è®¾å¤‡æ–¹å‘äº‹ä»¶
        if ('onorientationchange' in window) {
            window.addEventListener('orientationchange', (event) => {
                console.log('è®¾å¤‡æ–¹å‘æ”¹å˜:', window.orientation);
            });
        }
        
        // è®¾å¤‡è¿åŠ¨äº‹ä»¶
        if ('ondevicemotion' in window) {
            window.addEventListener('devicemotion', (event) => {
                const acc = event.accelerationIncludingGravity;
                if (acc) {
                    console.log('è®¾å¤‡åŠ é€Ÿåº¦:', acc.x, acc.y, acc.z);
                }
            });
        }
        
        console.log('è®¾å¤‡äº‹ä»¶ç›‘å¬å·²è®¾ç½®');
    }
};

EventTypesExamples.uiEvents();
EventTypesExamples.focusEvents();
EventTypesExamples.deviceEvents();
```

---

## 13.2 å†’æ³¡ä¸æ•è·

JavaScriptäº‹ä»¶æµçš„ä¸‰ä¸ªé˜¶æ®µï¼šæ•è·é˜¶æ®µã€ç›®æ ‡é˜¶æ®µã€å†’æ³¡é˜¶æ®µã€‚

### äº‹ä»¶æµæœºåˆ¶

ç†è§£äº‹ä»¶åœ¨DOMæ ‘ä¸­çš„ä¼ æ’­è¿‡ç¨‹ï¼š

```javascript
/**
 * äº‹ä»¶æµæœºåˆ¶ç¤ºä¾‹
 */
const EventFlowExamples = {
    /**
     * å†’æ³¡å’Œæ•è·æ¼”ç¤º
     */
    bubbleAndCaptureDemo() {
        console.log('=== å†’æ³¡å’Œæ•è·æ¼”ç¤º ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºåµŒå¥—ç»“æ„
        const outer = document.createElement('div');
        const middle = document.createElement('div');
        const inner = document.createElement('div');
        
        outer.style.cssText = `
            width: 300px; height: 300px;
            background: red; padding: 20px;
            border: 2px solid darkred;
        `;
        
        middle.style.cssText = `
            width: 200px; height: 200px;
            background: green; padding: 20px;
            border: 2px solid darkgreen;
        `;
        
        inner.style.cssText = `
            width: 100px; height: 100px;
            background: blue; padding: 20px;
            border: 2px solid darkblue;
            color: white; display: flex;
            align-items: center; justify-content: center;
        `;
        
        outer.id = 'outer';
        middle.id = 'middle';
        inner.id = 'inner';
        inner.textContent = 'ç‚¹å‡»æˆ‘';
        
        outer.appendChild(middle);
        middle.appendChild(inner);
        document.body.appendChild(outer);
        
        // æ•è·é˜¶æ®µç›‘å¬
        outer.addEventListener('click', (event) => {
            console.log('ğŸ”½ outer - æ•è·é˜¶æ®µ');
        }, true);
        
        middle.addEventListener('click', (event) => {
            console.log('ğŸ”½ middle - æ•è·é˜¶æ®µ');
        }, true);
        
        inner.addEventListener('click', (event) => {
            console.log('ğŸ¯ inner - ç›®æ ‡é˜¶æ®µ');
        });
        
        // å†’æ³¡é˜¶æ®µç›‘å¬
        inner.addEventListener('click', (event) => {
            console.log('ğŸ”¼ inner - å†’æ³¡é˜¶æ®µ');
        });
        
        middle.addEventListener('click', (event) => {
            console.log('ğŸ”¼ middle - å†’æ³¡é˜¶æ®µ');
        });
        
        outer.addEventListener('click', (event) => {
            console.log('ğŸ”¼ outer - å†’æ³¡é˜¶æ®µ');
        });
        
        console.log('ç‚¹å‡»è“è‰²åŒºåŸŸè§‚å¯Ÿäº‹ä»¶æµ');
    },
    
    /**
     * äº‹ä»¶é˜¶æ®µæ£€æµ‹
     */
    eventPhaseDetection() {
        console.log('=== äº‹ä»¶é˜¶æ®µæ£€æµ‹ ===');
        
        if (typeof document === 'undefined') return;
        
        const container = document.createElement('div');
        const button = document.createElement('button');
        
        container.style.cssText = `
            padding: 20px; background: lightgray;
            margin: 10px; border: 1px solid gray;
        `;
        button.textContent = 'æµ‹è¯•æŒ‰é’®';
        
        container.appendChild(button);
        document.body.appendChild(container);
        
        // ç»Ÿä¸€äº‹ä»¶å¤„ç†å‡½æ•°
        function handleEvent(event) {
            const phases = {
                1: 'CAPTURING_PHASE (æ•è·)',
                2: 'AT_TARGET (ç›®æ ‡)',
                3: 'BUBBLING_PHASE (å†’æ³¡)'
            };
            
            console.log(`${event.currentTarget.tagName} - ${phases[event.eventPhase]}`);
            console.log('  target:', event.target.tagName);
            console.log('  currentTarget:', event.currentTarget.tagName);
            console.log('  eventPhase:', event.eventPhase);
        }
        
        // æ·»åŠ å„é˜¶æ®µç›‘å¬
        container.addEventListener('click', handleEvent, true);  // æ•è·
        button.addEventListener('click', handleEvent, false);    // ç›®æ ‡/å†’æ³¡
        container.addEventListener('click', handleEvent, false); // å†’æ³¡
        
        console.log('äº‹ä»¶é˜¶æ®µæ£€æµ‹è®¾ç½®å®Œæˆ');
    },
    
    /**
     * äº‹ä»¶è·¯å¾„è¿½è¸ª
     */
    eventPathTracking() {
        console.log('=== äº‹ä»¶è·¯å¾„è¿½è¸ª ===');
        
        if (typeof document === 'undefined') return;
        
        const section = document.createElement('section');
        const article = document.createElement('article');
        const p = document.createElement('p');
        const span = document.createElement('span');
        
        section.className = 'section';
        article.className = 'article';
        p.className = 'paragraph';
        span.className = 'text';
        span.textContent = 'è¿½è¸ªè·¯å¾„';
        
        section.style.cssText = `
            padding: 15px; background: #f0f0f0;
            border: 1px solid #ccc; margin: 10px;
        `;
        
        section.appendChild(article);
        article.appendChild(p);
        p.appendChild(span);
        document.body.appendChild(section);
        
        // è·¯å¾„è¿½è¸ªå¤„ç†å‡½æ•°
        function trackEventPath(event) {
            console.log('=== äº‹ä»¶è·¯å¾„ä¿¡æ¯ ===');
            
            // ä½¿ç”¨composedPath()è·å–å®Œæ•´è·¯å¾„
            if (event.composedPath) {
                const path = event.composedPath();
                console.log('å®Œæ•´äº‹ä»¶è·¯å¾„:');
                path.forEach((element, index) => {
                    const name = element.tagName || element.constructor.name;
                    const className = element.className || '';
                    console.log(`  ${index}: ${name} ${className}`);
                });
            }
            
            // æ‰‹åŠ¨è¿½è¸ªè·¯å¾„
            console.log('æ‰‹åŠ¨è·¯å¾„è¿½è¸ª:');
            let current = event.target;
            let depth = 0;
            
            while (current) {
                const name = current.tagName || current.constructor.name;
                const className = current.className || '';
                console.log(`  ${depth}: ${name} ${className}`);
                
                current = current.parentElement;
                depth++;
                
                if (depth > 10) break; // é˜²æ­¢æ— é™å¾ªç¯
            }
        }
        
        span.addEventListener('click', trackEventPath);
        
        console.log('äº‹ä»¶è·¯å¾„è¿½è¸ªè®¾ç½®å®Œæˆ');
    }
};

EventFlowExamples.bubbleAndCaptureDemo();
EventFlowExamples.eventPhaseDetection();
EventFlowExamples.eventPathTracking();
```

---

## 13.3 é˜»æ­¢é»˜è®¤ä¸é˜»æ­¢ä¼ æ’­

æ§åˆ¶äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºå’Œä¼ æ’­è¿‡ç¨‹ã€‚

### äº‹ä»¶æ§åˆ¶æ–¹æ³•

æŒæ¡preventDefaultå’ŒstopPropagationçš„ä½¿ç”¨ï¼š

```javascript
/**
 * äº‹ä»¶æ§åˆ¶ç¤ºä¾‹
 */
const EventControlExamples = {
    /**
     * é˜»æ­¢é»˜è®¤è¡Œä¸º
     */
    preventDefaultDemo() {
        console.log('=== é˜»æ­¢é»˜è®¤è¡Œä¸º ===');
        
        if (typeof document === 'undefined') return;
        
        // é“¾æ¥ç¤ºä¾‹
        const link = document.createElement('a');
        link.href = 'https://example.com';
        link.textContent = 'ç‚¹å‡»è¿™ä¸ªé“¾æ¥ï¼ˆå·²é˜»æ­¢è·³è½¬ï¼‰';
        link.style.display = 'block';
        link.style.margin = '10px';
        
        link.addEventListener('click', (event) => {
            event.preventDefault();
            console.log('é“¾æ¥ç‚¹å‡»è¢«é˜»æ­¢ï¼Œä¸ä¼šè·³è½¬');
            alert('è·³è½¬è¢«é˜»æ­¢ï¼');
        });
        
        document.body.appendChild(link);
        
        // è¡¨å•æäº¤ç¤ºä¾‹
        const form = document.createElement('form');
        form.innerHTML = `
            <div style="margin: 10px; padding: 10px; border: 1px solid #ccc;">
                <input type="text" placeholder="è¾“å…¥å†…å®¹" required>
                <button type="submit">æäº¤ï¼ˆå·²é˜»æ­¢ï¼‰</button>
            </div>
        `;
        
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            console.log('è¡¨å•æäº¤è¢«é˜»æ­¢');
            
            const input = form.querySelector('input');
            if (input.value.trim()) {
                console.log('è¡¨å•æ•°æ®:', input.value);
                alert(`æ•°æ®: ${input.value}`);
            } else {
                alert('è¯·è¾“å…¥å†…å®¹');
            }
        });
        
        document.body.appendChild(form);
        
        // å³é”®èœå•ç¤ºä¾‹
        const contextDiv = document.createElement('div');
        contextDiv.style.cssText = `
            width: 200px; height: 100px;
            background: lightyellow; border: 1px solid orange;
            display: flex; align-items: center; justify-content: center;
            margin: 10px; cursor: pointer;
        `;
        contextDiv.textContent = 'å³é”®ç‚¹å‡»ï¼ˆèœå•è¢«é˜»æ­¢ï¼‰';
        
        contextDiv.addEventListener('contextmenu', (event) => {
            event.preventDefault();
            console.log('å³é”®èœå•è¢«é˜»æ­¢');
            
            // æ˜¾ç¤ºè‡ªå®šä¹‰èœå•
            const customMenu = document.createElement('div');
            customMenu.style.cssText = `
                position: absolute;
                left: ${event.pageX}px;
                top: ${event.pageY}px;
                background: white;
                border: 1px solid #ccc;
                padding: 5px;
                box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            `;
            customMenu.innerHTML = `
                <div style="padding: 5px; cursor: pointer;">è‡ªå®šä¹‰èœå•é¡¹1</div>
                <div style="padding: 5px; cursor: pointer;">è‡ªå®šä¹‰èœå•é¡¹2</div>
            `;
            
            document.body.appendChild(customMenu);
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
            const closeMenu = () => {
                document.body.removeChild(customMenu);
                document.removeEventListener('click', closeMenu);
            };
            setTimeout(() => document.addEventListener('click', closeMenu), 100);
        });
        
        document.body.appendChild(contextDiv);
        
        console.log('é˜»æ­¢é»˜è®¤è¡Œä¸ºç¤ºä¾‹è®¾ç½®å®Œæˆ');
    },
    
    /**
     * é˜»æ­¢äº‹ä»¶ä¼ æ’­
     */
    stopPropagationDemo() {
        console.log('=== é˜»æ­¢äº‹ä»¶ä¼ æ’­ ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºåµŒå¥—ç»“æ„
        const parent = document.createElement('div');
        const child = document.createElement('div');
        
        parent.style.cssText = `
            width: 200px; height: 200px;
            background: lightblue; padding: 20px;
            border: 2px solid blue; margin: 10px;
        `;
        
        child.style.cssText = `
            width: 100px; height: 100px;
            background: lightcoral; border: 2px solid red;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; cursor: pointer;
        `;
        
        child.textContent = 'ç‚¹å‡»æˆ‘';
        parent.appendChild(child);
        document.body.appendChild(parent);
        
        // çˆ¶å…ƒç´ ç›‘å¬
        parent.addEventListener('click', (event) => {
            console.log('çˆ¶å…ƒç´ è¢«ç‚¹å‡»');
            alert('çˆ¶å…ƒç´ äº‹ä»¶è§¦å‘');
        });
        
        // å­å…ƒç´ ç›‘å¬ï¼ˆé˜»æ­¢å†’æ³¡ï¼‰
        child.addEventListener('click', (event) => {
            console.log('å­å…ƒç´ è¢«ç‚¹å‡»');
            event.stopPropagation(); // é˜»æ­¢å†’æ³¡
            alert('å­å…ƒç´ äº‹ä»¶è§¦å‘ï¼ˆå·²é˜»æ­¢å†’æ³¡ï¼‰');
        });
        
        // stopImmediatePropagationç¤ºä¾‹
        const multiButton = document.createElement('button');
        multiButton.textContent = 'å¤šä¸ªç›‘å¬å™¨æŒ‰é’®';
        multiButton.style.margin = '10px';
        
        multiButton.addEventListener('click', (event) => {
            console.log('ç¬¬ä¸€ä¸ªç›‘å¬å™¨');
            event.stopImmediatePropagation(); // é˜»æ­¢åç»­ç›‘å¬å™¨
        });
        
        multiButton.addEventListener('click', (event) => {
            console.log('ç¬¬äºŒä¸ªç›‘å¬å™¨ï¼ˆä¸ä¼šæ‰§è¡Œï¼‰');
        });
        
        multiButton.addEventListener('click', (event) => {
            console.log('ç¬¬ä¸‰ä¸ªç›‘å¬å™¨ï¼ˆä¸ä¼šæ‰§è¡Œï¼‰');
        });
        
        document.body.appendChild(multiButton);
        
        console.log('é˜»æ­¢äº‹ä»¶ä¼ æ’­ç¤ºä¾‹è®¾ç½®å®Œæˆ');
    },
    
    /**
     * äº‹ä»¶æ§åˆ¶æœ€ä½³å®è·µ
     */
    eventControlBestPractices() {
        console.log('=== äº‹ä»¶æ§åˆ¶æœ€ä½³å®è·µ ===');
        
        if (typeof document === 'undefined') return;
        
        // æ¡ä»¶æ€§é˜»æ­¢
        const conditionalForm = document.createElement('form');
        conditionalForm.innerHTML = `
            <div style="margin: 10px; padding: 10px; border: 1px solid #ccc;">
                <label>
                    <input type="checkbox" id="agreeCheckbox">
                    åŒæ„æ¡æ¬¾
                </label><br>
                <button type="submit" style="margin-top: 10px;">æäº¤</button>
            </div>
        `;
        
        conditionalForm.addEventListener('submit', (event) => {
            const checkbox = conditionalForm.querySelector('#agreeCheckbox');
            
            if (!checkbox.checked) {
                event.preventDefault();
                alert('è¯·å…ˆåŒæ„æ¡æ¬¾');
                console.log('æäº¤è¢«é˜»æ­¢ï¼šæœªåŒæ„æ¡æ¬¾');
            } else {
                event.preventDefault(); // æ¼”ç¤ºç”¨ï¼Œå®é™…ä¸­å¯èƒ½å…è®¸æäº¤
                alert('è¡¨å•éªŒè¯é€šè¿‡ï¼');
                console.log('è¡¨å•éªŒè¯é€šè¿‡');
            }
        });
        
        document.body.appendChild(conditionalForm);
        
        // äº‹ä»¶æ§åˆ¶å·¥å…·ç±»
        class EventController {
            constructor() {
                this.controlledEvents = new Map();
            }
            
            // æ·»åŠ å¯æ§åˆ¶çš„äº‹ä»¶
            addControlledEvent(element, type, handler, options = {}) {
                const wrappedHandler = (event) => {
                    const control = this.controlledEvents.get(element);
                    
                    if (control && control.disabled) {
                        console.log(`äº‹ä»¶ ${type} è¢«ç¦ç”¨`);
                        return;
                    }
                    
                    if (control && control.preventDefault) {
                        event.preventDefault();
                    }
                    
                    if (control && control.stopPropagation) {
                        event.stopPropagation();
                    }
                    
                    handler(event);
                };
                
                element.addEventListener(type, wrappedHandler, options);
                
                if (!this.controlledEvents.has(element)) {
                    this.controlledEvents.set(element, {
                        disabled: false,
                        preventDefault: false,
                        stopPropagation: false
                    });
                }
                
                return wrappedHandler;
            }
            
            // ç¦ç”¨å…ƒç´ çš„æ‰€æœ‰äº‹ä»¶
            disableEvents(element) {
                const control = this.controlledEvents.get(element);
                if (control) {
                    control.disabled = true;
                }
            }
            
            // å¯ç”¨å…ƒç´ çš„æ‰€æœ‰äº‹ä»¶
            enableEvents(element) {
                const control = this.controlledEvents.get(element);
                if (control) {
                    control.disabled = false;
                }
            }
            
            // è®¾ç½®é»˜è®¤è¡Œä¸ºæ§åˆ¶
            setPreventDefault(element, prevent) {
                const control = this.controlledEvents.get(element);
                if (control) {
                    control.preventDefault = prevent;
                }
            }
            
            // è®¾ç½®ä¼ æ’­æ§åˆ¶
            setStopPropagation(element, stop) {
                const control = this.controlledEvents.get(element);
                if (control) {
                    control.stopPropagation = stop;
                }
            }
        }
        
        const controller = new EventController();
        console.log('äº‹ä»¶æ§åˆ¶å·¥å…·ç±»å·²åˆ›å»º');
    }
};

EventControlExamples.preventDefaultDemo();
EventControlExamples.stopPropagationDemo();
EventControlExamples.eventControlBestPractices();
```

---

## 13.4 äº‹ä»¶å§”æ‰˜

åˆ©ç”¨äº‹ä»¶å†’æ³¡å®ç°é«˜æ•ˆçš„äº‹ä»¶ç®¡ç†æ¨¡å¼ã€‚

### å§”æ‰˜æ¨¡å¼åŸç†

äº‹ä»¶å§”æ‰˜çš„æ ¸å¿ƒæ¦‚å¿µå’Œå®ç°ï¼š

```javascript
/**
 * äº‹ä»¶å§”æ‰˜ç¤ºä¾‹
 */
const EventDelegationExamples = {
    /**
     * åŸºç¡€äº‹ä»¶å§”æ‰˜
     */
    basicDelegation() {
        console.log('=== åŸºç¡€äº‹ä»¶å§”æ‰˜ ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºåŠ¨æ€åˆ—è¡¨
        const container = document.createElement('div');
        container.innerHTML = `
            <h3>åŠ¨æ€åˆ—è¡¨ (äº‹ä»¶å§”æ‰˜)</h3>
            <button id="addItem">æ·»åŠ é¡¹ç›®</button>
            <ul id="itemList"></ul>
        `;
        container.style.cssText = `
            margin: 10px; padding: 15px;
            border: 1px solid #ccc; background: #f9f9f9;
        `;
        document.body.appendChild(container);
        
        const addBtn = container.querySelector('#addItem');
        const itemList = container.querySelector('#itemList');
        let itemCount = 0;
        
        // æ·»åŠ æ–°é¡¹ç›®
        addBtn.addEventListener('click', () => {
            itemCount++;
            const li = document.createElement('li');
            li.innerHTML = `
                é¡¹ç›® ${itemCount} 
                <button class="delete-btn" data-id="${itemCount}">åˆ é™¤</button>
                <button class="edit-btn" data-id="${itemCount}">ç¼–è¾‘</button>
            `;
            li.style.cssText = `
                margin: 5px 0; padding: 8px;
                background: white; border: 1px solid #ddd;
            `;
            itemList.appendChild(li);
        });
        
        // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†åŠ¨æ€æ·»åŠ çš„æŒ‰é’®
        itemList.addEventListener('click', (event) => {
            const target = event.target;
            
            if (target.classList.contains('delete-btn')) {
                const id = target.dataset.id;
                console.log(`åˆ é™¤é¡¹ç›® ${id}`);
                target.parentElement.remove();
            } else if (target.classList.contains('edit-btn')) {
                const id = target.dataset.id;
                console.log(`ç¼–è¾‘é¡¹ç›® ${id}`);
                const newText = prompt('è¾“å…¥æ–°æ–‡æœ¬:', `é¡¹ç›® ${id}`);
                if (newText) {
                    const textNode = target.parentElement.firstChild;
                    textNode.textContent = newText + ' ';
                }
            }
        });
        
        // åˆå§‹æ·»åŠ å‡ ä¸ªé¡¹ç›®
        for (let i = 0; i < 3; i++) {
            addBtn.click();
        }
        
        console.log('åŸºç¡€äº‹ä»¶å§”æ‰˜è®¾ç½®å®Œæˆ');
    },
    
    /**
     * é«˜çº§å§”æ‰˜é€‰æ‹©å™¨
     */
    advancedDelegation() {
        console.log('=== é«˜çº§å§”æ‰˜é€‰æ‹©å™¨ ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºå¤æ‚çš„åµŒå¥—ç»“æ„
        const app = document.createElement('div');
        app.innerHTML = `
            <div class="card-container">
                <div class="card" data-type="user">
                    <h4>ç”¨æˆ·å¡ç‰‡</h4>
                    <button class="action-btn" data-action="view">æŸ¥çœ‹</button>
                    <button class="action-btn" data-action="edit">ç¼–è¾‘</button>
                </div>
                <div class="card" data-type="product">
                    <h4>äº§å“å¡ç‰‡</h4>
                    <button class="action-btn" data-action="buy">è´­ä¹°</button>
                    <button class="action-btn" data-action="favorite">æ”¶è—</button>
                </div>
            </div>
        `;
        
        app.style.cssText = `
            margin: 10px; padding: 15px;
            border: 1px solid #ccc;
        `;
        
        const cardContainer = app.querySelector('.card-container');
        
        // å§”æ‰˜é€‰æ‹©å™¨å·¥å…·å‡½æ•°
        function delegate(container, selector, eventType, handler) {
            container.addEventListener(eventType, (event) => {
                const target = event.target.closest(selector);
                if (target && container.contains(target)) {
                    handler(event, target);
                }
            });
        }
        
        // ä½¿ç”¨å§”æ‰˜é€‰æ‹©å™¨
        delegate(cardContainer, '.action-btn', 'click', (event, button) => {
            const action = button.dataset.action;
            const card = button.closest('.card');
            const cardType = card.dataset.type;
            
            console.log(`æ‰§è¡ŒåŠ¨ä½œ: ${action}, å¡ç‰‡ç±»å‹: ${cardType}`);
            
            // æ ¹æ®åŠ¨ä½œç±»å‹æ‰§è¡Œç›¸åº”é€»è¾‘
            switch (action) {
                case 'view':
                    alert(`æŸ¥çœ‹${cardType}è¯¦æƒ…`);
                    break;
                case 'edit':
                    alert(`ç¼–è¾‘${cardType}ä¿¡æ¯`);
                    break;
                case 'buy':
                    alert(`è´­ä¹°${cardType}`);
                    break;
                case 'favorite':
                    button.textContent = button.textContent === 'æ”¶è—' ? 'å·²æ”¶è—' : 'æ”¶è—';
                    break;
            }
        });
        
        // å¡ç‰‡æ‚¬åœæ•ˆæœå§”æ‰˜
        delegate(cardContainer, '.card', 'mouseenter', (event, card) => {
            card.style.backgroundColor = '#f0f8ff';
        });
        
        delegate(cardContainer, '.card', 'mouseleave', (event, card) => {
            card.style.backgroundColor = '';
        });
        
        document.body.appendChild(app);
        
        console.log('é«˜çº§å§”æ‰˜é€‰æ‹©å™¨è®¾ç½®å®Œæˆ');
    },
    
    /**
     * æ€§èƒ½ä¼˜åŒ–å®è·µ
     */
    performanceOptimization() {
        console.log('=== æ€§èƒ½ä¼˜åŒ–å®è·µ ===');
        
        if (typeof document === 'undefined') return;
        
        // åˆ›å»ºå¤§é‡å…ƒç´ çš„å®¹å™¨
        const largeList = document.createElement('div');
        largeList.innerHTML = '<h3>å¤§é‡å…ƒç´ åˆ—è¡¨ (1000ä¸ª)</h3>';
        
        const list = document.createElement('ul');
        list.style.cssText = `
            max-height: 200px; overflow-y: auto;
            border: 1px solid #ddd; margin: 10px 0;
        `;
        
        // ç”Ÿæˆ1000ä¸ªåˆ—è¡¨é¡¹
        const fragment = document.createDocumentFragment();
        for (let i = 1; i <= 1000; i++) {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>é¡¹ç›® ${i}</span>
                <button class="like-btn" data-id="${i}">ğŸ‘ 0</button>
            `;
            li.style.cssText = `
                display: flex; justify-content: space-between;
                padding: 5px; border-bottom: 1px solid #eee;
            `;
            fragment.appendChild(li);
        }
        list.appendChild(fragment);
        
        // æ€§èƒ½è®¡æ—¶
        console.time('äº‹ä»¶å§”æ‰˜å¤„ç†1000ä¸ªæŒ‰é’®');
        
        // å•ä¸ªäº‹ä»¶ç›‘å¬å™¨å¤„ç†æ‰€æœ‰æŒ‰é’®ï¼ˆå§”æ‰˜æ–¹å¼ï¼‰
        let clickCount = 0;
        list.addEventListener('click', (event) => {
            if (event.target.classList.contains('like-btn')) {
                clickCount++;
                const button = event.target;
                const currentLikes = parseInt(button.textContent.split(' ')[1]) + 1;
                button.textContent = `ğŸ‘ ${currentLikes}`;
                
                if (clickCount % 100 === 0) {
                    console.log(`å¤„ç†äº† ${clickCount} æ¬¡ç‚¹å‡»`);
                }
            }
        });
        
        console.timeEnd('äº‹ä»¶å§”æ‰˜å¤„ç†1000ä¸ªæŒ‰é’®');
        
        largeList.appendChild(list);
        
        // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
        const stats = document.createElement('div');
        stats.style.cssText = `
            padding: 10px; background: #f0f0f0;
            border: 1px solid #ccc; margin: 10px 0;
        `;
        stats.innerHTML = `
            <strong>æ€§èƒ½å¯¹æ¯”:</strong><br>
            âŒ ä¸ºæ¯ä¸ªæŒ‰é’®å•ç‹¬æ·»åŠ äº‹ä»¶ç›‘å¬å™¨: 1000ä¸ªç›‘å¬å™¨<br>
            âœ… ä½¿ç”¨äº‹ä»¶å§”æ‰˜: ä»…1ä¸ªç›‘å¬å™¨<br>
            <em>å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½éƒ½å¤§å¤§ä¼˜åŒ–</em>
        `;
        
        largeList.appendChild(stats);
        document.body.appendChild(largeList);
        
        console.log('æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹è®¾ç½®å®Œæˆ');
    }
};

EventDelegationExamples.basicDelegation();
EventDelegationExamples.advancedDelegation();
EventDelegationExamples.performanceOptimization();
```

---

## 13.5 é¼ æ ‡ã€é”®ç›˜ã€è¡¨å•äº‹ä»¶

å¤„ç†å„ç§ç”¨æˆ·è¾“å…¥äº‹ä»¶ã€‚

### é¼ æ ‡äº‹ä»¶å¤„ç†

é¼ æ ‡äº¤äº’çš„å®Œæ•´å¤„ç†ï¼š

```javascript
/**
 * é¼ æ ‡äº‹ä»¶å¤„ç†ç¤ºä¾‹
 */
const MouseEventExamples = {
    /**
     * åŸºç¡€é¼ æ ‡äº‹ä»¶
     */
    basicMouseEvents() {
        console.log('=== åŸºç¡€é¼ æ ‡äº‹ä»¶ ===');
        
        if (typeof document === 'undefined') return;
        
        const mouseArea = document.createElement('div');
        mouseArea.style.cssText = `
            width: 300px; height: 200px;
            background: lightgray; border: 2px solid gray;
            margin: 10px; position: relative; cursor: crosshair;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold;
        `;
        mouseArea.textContent = 'é¼ æ ‡äº¤äº’åŒºåŸŸ';
        
        const infoDiv = document.createElement('div');
        infoDiv.style.cssText = `
            margin: 10px; padding: 10px;
            background: #f0f0f0; border: 1px solid #ccc;
            font-family: monospace; font-size: 12px;
        `;
        
        function updateInfo(text) {
            infoDiv.textContent = text;
        }
        
        // é¼ æ ‡äº‹ä»¶ç›‘å¬
        mouseArea.addEventListener('mouseenter', (event) => {
            updateInfo('é¼ æ ‡è¿›å…¥åŒºåŸŸ');
            mouseArea.style.backgroundColor = 'lightblue';
        });
        
        mouseArea.addEventListener('mouseleave', (event) => {
            updateInfo('é¼ æ ‡ç¦»å¼€åŒºåŸŸ');
            mouseArea.style.backgroundColor = 'lightgray';
        });
        
        mouseArea.addEventListener('mousemove', (event) => {
            const rect = mouseArea.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            updateInfo(`é¼ æ ‡ä½ç½®: (${Math.round(x)}, ${Math.round(y)})`);
        });
        
        mouseArea.addEventListener('mousedown', (event) => {
            updateInfo(`é¼ æ ‡æŒ‰ä¸‹: æŒ‰é’®${event.button}`);
            mouseArea.style.backgroundColor = 'lightcoral';
        });
        
        mouseArea.addEventListener('mouseup', (event) => {
            updateInfo(`é¼ æ ‡æ¾å¼€: æŒ‰é’®${event.button}`);
            mouseArea.style.backgroundColor = 'lightblue';
        });
        
        mouseArea.addEventListener('click', (event) => {
            updateInfo(`ç‚¹å‡»: (${event.offsetX}, ${event.offsetY})`);
        });
        
        mouseArea.addEventListener('dblclick', (event) => {
            updateInfo('åŒå‡»äº‹ä»¶');
            mouseArea.style.backgroundColor = 'yellow';
            setTimeout(() => {
                mouseArea.style.backgroundColor = 'lightblue';
            }, 200);
        });
        
        document.body.appendChild(mouseArea);
        document.body.appendChild(infoDiv);
        
        console.log('åŸºç¡€é¼ æ ‡äº‹ä»¶è®¾ç½®å®Œæˆ');
    },
    
    /**
     * æ‹–æ‹½å®ç°
     */
    dragAndDrop() {
        console.log('=== æ‹–æ‹½å®ç° ===');
        
        if (typeof document === 'undefined') return;
        
        const dragContainer = document.createElement('div');
        dragContainer.style.cssText = `
            width: 400px; height: 300px;
            border: 2px dashed #ccc; margin: 10px;
            position: relative; background: #fafafa;
        `;
        
        // åˆ›å»ºå¯æ‹–æ‹½å…ƒç´ 
        const draggable = document.createElement('div');
        draggable.style.cssText = `
            width: 50px; height: 50px;
            background: red; position: absolute;
            top: 20px; left: 20px; cursor: move;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; user-select: none;
        `;
        draggable.textContent = 'æ‹–æˆ‘';
        
        let isDragging = false;
        let offset = { x: 0, y: 0 };
        
        draggable.addEventListener('mousedown', (event) => {
            isDragging = true;
            
            const rect = draggable.getBoundingClientRect();
            const containerRect = dragContainer.getBoundingClientRect();
            
            offset.x = event.clientX - rect.left;
            offset.y = event.clientY - rect.top;
            
            draggable.style.backgroundColor = 'darkred';
            dragContainer.style.cursor = 'grabbing';
            
            event.preventDefault(); // é˜²æ­¢æ–‡æœ¬é€‰æ‹©
        });
        
        document.addEventListener('mousemove', (event) => {
            if (!isDragging) return;
            
            const containerRect = dragContainer.getBoundingClientRect();
            
            let newX = event.clientX - containerRect.left - offset.x;
            let newY = event.clientY - containerRect.top - offset.y;
            
            // è¾¹ç•Œæ£€æµ‹
            newX = Math.max(0, Math.min(newX, dragContainer.clientWidth - draggable.offsetWidth));
            newY = Math.max(0, Math.min(newY, dragContainer.clientHeight - draggable.offsetHeight));
            
            draggable.style.left = newX + 'px';
            draggable.style.top = newY + 'px';
        });
        
        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                draggable.style.backgroundColor = 'red';
                dragContainer.style.cursor = '';
            }
        });
        
        dragContainer.appendChild(draggable);
        document.body.appendChild(dragContainer);
        
        console.log('æ‹–æ‹½åŠŸèƒ½è®¾ç½®å®Œæˆ');
    }
};

MouseEventExamples.basicMouseEvents();
MouseEventExamples.dragAndDrop();
```

### é”®ç›˜äº‹ä»¶ç®¡ç†

é”®ç›˜è¾“å…¥çš„å¤„ç†å’Œç®¡ç†ï¼š

```javascript
/**
 * é”®ç›˜äº‹ä»¶ç¤ºä¾‹
 */
const KeyboardEventExamples = {
    /**
     * åŸºç¡€é”®ç›˜äº‹ä»¶
     */
    basicKeyboardEvents() {
        console.log('=== åŸºç¡€é”®ç›˜äº‹ä»¶ ===');
        
        if (typeof document === 'undefined') return;
        
        const keyboardDemo = document.createElement('div');
        keyboardDemo.innerHTML = `
            <h3>é”®ç›˜äº‹ä»¶æµ‹è¯•</h3>
            <input type="text" placeholder="åœ¨è¿™é‡Œè¾“å…¥æµ‹è¯•é”®ç›˜äº‹ä»¶" style="padding: 10px; width: 300px;">
            <div id="keyInfo" style="margin: 10px 0; padding: 10px; background: #f0f0f0; font-family: monospace; min-height: 100px;"></div>
        `;
        
        const input = keyboardDemo.querySelector('input');
        const keyInfo = keyboardDemo.querySelector('#keyInfo');
        
        function displayKeyInfo(event, eventType) {
            const info = `
                äº‹ä»¶: ${eventType}
                æŒ‰é”®: ${event.key}
                ä»£ç : ${event.code}
                é”®å€¼: ${event.keyCode} (å·²åºŸå¼ƒ)
                ä¿®é¥°é”®: Ctrl:${event.ctrlKey} Shift:${event.shiftKey} Alt:${event.altKey}
                é‡å¤: ${event.repeat}
                æ—¶é—´: ${new Date().toLocaleTimeString()}
            `;
            keyInfo.textContent = info;
        }
        
        input.addEventListener('keydown', (event) => {
            displayKeyInfo(event, 'keydown');
            
            // å¿«æ·é”®å¤„ç†
            if (event.ctrlKey && event.key === 'a') {
                console.log('Ctrl+A: å…¨é€‰');
            } else if (event.ctrlKey && event.key === 's') {
                event.preventDefault();
                console.log('Ctrl+S: ä¿å­˜ (å·²é˜»æ­¢é»˜è®¤è¡Œä¸º)');
            }
        });
        
        input.addEventListener('keyup', (event) => {
            displayKeyInfo(event, 'keyup');
        });
        
        input.addEventListener('keypress', (event) => {
            displayKeyInfo(event, 'keypress (å·²åºŸå¼ƒ)');
        });
        
        document.body.appendChild(keyboardDemo);
        
        console.log('åŸºç¡€é”®ç›˜äº‹ä»¶è®¾ç½®å®Œæˆ');
    },
    
    /**
     * é«˜çº§é”®ç›˜åŠŸèƒ½
     */
    advancedKeyboardFeatures() {
        console.log('=== é«˜çº§é”®ç›˜åŠŸèƒ½ ===');
        
        if (typeof document === 'undefined') return;
        
        const advancedDemo = document.createElement('div');
        advancedDemo.innerHTML = `
            <h3>é«˜çº§é”®ç›˜åŠŸèƒ½</h3>
            <textarea placeholder="æ”¯æŒå¿«æ·é”®çš„æ–‡æœ¬ç¼–è¾‘å™¨..." 
                     style="width: 400px; height: 200px; padding: 10px; font-family: monospace;"></textarea>
            <div style="margin: 10px 0; font-size: 12px; color: #666;">
                å¿«æ·é”®: Ctrl+B(ç²—ä½“), Ctrl+I(æ–œä½“), Ctrl+U(ä¸‹åˆ’çº¿), Ctrl+Z(æ’¤é”€), Tab(ç¼©è¿›)
            </div>
            <div id="shortcutInfo" style="padding: 10px; background: #e8f4fd; margin: 10px 0;"></div>
        `;
        
        const textarea = advancedDemo.querySelector('textarea');
        const shortcutInfo = advancedDemo.querySelector('#shortcutInfo');
        
        // æ’¤é”€åŠŸèƒ½
        let history = [];
        let historyIndex = -1;
        
        function saveState() {
            historyIndex++;
            history = history.slice(0, historyIndex);
            history.push(textarea.value);
            
            if (history.length > 50) { // é™åˆ¶å†å²è®°å½•
                history.shift();
                historyIndex--;
            }
        }
        
        // åˆå§‹çŠ¶æ€
        saveState();
        
        textarea.addEventListener('input', () => {
            saveState();
        });
        
        textarea.addEventListener('keydown', (event) => {
            const key = event.key;
            const ctrl = event.ctrlKey;
            const shift = event.shiftKey;
            
            let shortcutUsed = '';
            
            if (ctrl && key === 'z' && !shift) {
                // æ’¤é”€
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    textarea.value = history[historyIndex];
                    shortcutUsed = 'Ctrl+Z: æ’¤é”€';
                }
            } else if (ctrl && key === 'z' && shift) {
                // é‡åš
                event.preventDefault();
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    textarea.value = history[historyIndex];
                    shortcutUsed = 'Ctrl+Shift+Z: é‡åš';
                }
            } else if (ctrl && key === 'b') {
                // ç²—ä½“
                event.preventDefault();
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const text = textarea.value;
                const selectedText = text.substring(start, end);
                
                if (selectedText) {
                    textarea.value = text.substring(0, start) + `**${selectedText}**` + text.substring(end);
                    shortcutUsed = 'Ctrl+B: ç²—ä½“æ ‡è®°';
                }
            } else if (key === 'Tab') {
                // Tabç¼©è¿›
                event.preventDefault();
                const start = textarea.selectionStart;
                textarea.value = textarea.value.substring(0, start) + '    ' + textarea.value.substring(start);
                textarea.selectionStart = textarea.selectionEnd = start + 4;
                shortcutUsed = 'Tab: ç¼©è¿›';
            }
            
            if (shortcutUsed) {
                shortcutInfo.textContent = shortcutUsed;
                setTimeout(() => {
                    shortcutInfo.textContent = '';
                }, 2000);
            }
        });
        
        document.body.appendChild(advancedDemo);
        
        console.log('é«˜çº§é”®ç›˜åŠŸèƒ½è®¾ç½®å®Œæˆ');
    }
};

KeyboardEventExamples.basicKeyboardEvents();
KeyboardEventExamples.advancedKeyboardFeatures();
```

---

## 13.6 TodoList äº‹ä»¶ç®¡ç†å®æˆ˜

é€šè¿‡å®Œæ•´çš„TodoListé¡¹ç›®å±•ç¤ºäº‹ä»¶ç®¡ç†çš„æœ€ä½³å®è·µã€‚

### é¡¹ç›®æ¶æ„è®¾è®¡

æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„TodoListåº”ç”¨ï¼š

```javascript
/**
 * TodoList äº‹ä»¶ç®¡ç†å®æˆ˜
 */
class TodoApp {
    constructor(container) {
        this.container = container;
        this.todos = [];
        this.nextId = 1;
        this.filter = 'all'; // all, active, completed
        
        this.init();
    }
    
    /**
     * åˆå§‹åŒ–åº”ç”¨
     */
    init() {
        this.render();
        this.bindEvents();
        this.loadFromStorage();
    }
    
    /**
     * æ¸²æŸ“åº”ç”¨ç»“æ„
     */
    render() {
        this.container.innerHTML = `
            <div class="todo-app">
                <header class="todo-header">
                    <h1>TodoList äº‹ä»¶ç®¡ç†å®æˆ˜</h1>
                    <div class="input-container">
                        <input type="text" 
                               class="todo-input" 
                               placeholder="æ·»åŠ æ–°ä»»åŠ¡..." 
                               maxlength="100">
                        <button class="add-btn">æ·»åŠ </button>
                    </div>
                </header>
                
                <main class="todo-main">
                    <div class="filter-bar">
                        <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                        <button class="filter-btn" data-filter="active">æœªå®Œæˆ</button>
                        <button class="filter-btn" data-filter="completed">å·²å®Œæˆ</button>
                    </div>
                    
                    <ul class="todo-list"></ul>
                    
                    <div class="todo-stats">
                        <span class="stats-info">æ€»è®¡: <span class="total-count">0</span> é¡¹</span>
                        <button class="clear-completed" style="display: none;">æ¸…é™¤å·²å®Œæˆ</button>
                    </div>
                </main>
            </div>
        `;
        
        // æ·»åŠ æ ·å¼
        this.addStyles();
        this.updateDisplay();
    }
    
    /**
     * ç»‘å®šæ‰€æœ‰äº‹ä»¶
     */
    bindEvents() {
        // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†æ‰€æœ‰äº¤äº’
        this.container.addEventListener('click', this.handleClick.bind(this));
        this.container.addEventListener('keydown', this.handleKeydown.bind(this));
        this.container.addEventListener('change', this.handleChange.bind(this));
        this.container.addEventListener('input', this.handleInput.bind(this));
        
        // çª—å£äº‹ä»¶
        window.addEventListener('beforeunload', () => {
            this.saveToStorage();
        });
    }
    
    /**
     * ç»Ÿä¸€çš„ç‚¹å‡»äº‹ä»¶å¤„ç†
     */
    handleClick(event) {
        const target = event.target;
        
        if (target.classList.contains('add-btn')) {
            this.addTodo();
        } else if (target.classList.contains('filter-btn')) {
            this.setFilter(target.dataset.filter);
        } else if (target.classList.contains('clear-completed')) {
            this.clearCompleted();
        } else if (target.classList.contains('delete-btn')) {
            const id = parseInt(target.closest('.todo-item').dataset.id);
            this.deleteTodo(id);
        } else if (target.classList.contains('edit-btn')) {
            const id = parseInt(target.closest('.todo-item').dataset.id);
            this.startEdit(id);
        } else if (target.classList.contains('save-btn')) {
            const id = parseInt(target.closest('.todo-item').dataset.id);
            this.saveEdit(id);
        } else if (target.classList.contains('cancel-btn')) {
            const id = parseInt(target.closest('.todo-item').dataset.id);
            this.cancelEdit(id);
        }
    }
    
    /**
     * é”®ç›˜äº‹ä»¶å¤„ç†
     */
    handleKeydown(event) {
        if (event.target.classList.contains('todo-input') && event.key === 'Enter') {
            this.addTodo();
        } else if (event.target.classList.contains('edit-input')) {
            if (event.key === 'Enter') {
                const id = parseInt(event.target.closest('.todo-item').dataset.id);
                this.saveEdit(id);
            } else if (event.key === 'Escape') {
                const id = parseInt(event.target.closest('.todo-item').dataset.id);
                this.cancelEdit(id);
            }
        }
        
        // å…¨å±€å¿«æ·é”®
        if (event.ctrlKey || event.metaKey) {
            switch (event.key) {
                case 'a':
                    event.preventDefault();
                    this.selectAll();
                    break;
                case 'd':
                    event.preventDefault();
                    this.clearCompleted();
                    break;
            }
        }
    }
    
    /**
     * è¡¨å•å˜åŒ–äº‹ä»¶å¤„ç†
     */
    handleChange(event) {
        if (event.target.classList.contains('todo-checkbox')) {
            const id = parseInt(event.target.closest('.todo-item').dataset.id);
            this.toggleTodo(id);
        }
    }
    
    /**
     * è¾“å…¥äº‹ä»¶å¤„ç†
     */
    handleInput(event) {
        if (event.target.classList.contains('todo-input')) {
            // å®æ—¶éªŒè¯è¾“å…¥
            const addBtn = this.container.querySelector('.add-btn');
            addBtn.disabled = !event.target.value.trim();
        }
    }
    
    /**
     * æ·»åŠ æ–°ä»»åŠ¡
     */
    addTodo() {
        const input = this.container.querySelector('.todo-input');
        const text = input.value.trim();
        
        if (!text) {
            this.showMessage('è¯·è¾“å…¥ä»»åŠ¡å†…å®¹', 'error');
            return;
        }
        
        const todo = {
            id: this.nextId++,
            text: text,
            completed: false,
            createdAt: new Date().toISOString()
        };
        
        this.todos.push(todo);
        input.value = '';
        
        this.updateDisplay();
        this.saveToStorage();
        this.showMessage('ä»»åŠ¡æ·»åŠ æˆåŠŸ', 'success');
    }
    
    /**
     * åˆ‡æ¢ä»»åŠ¡å®ŒæˆçŠ¶æ€
     */
    toggleTodo(id) {
        const todo = this.todos.find(t => t.id === id);
        if (todo) {
            todo.completed = !todo.completed;
            this.updateDisplay();
            this.saveToStorage();
        }
    }
    
    /**
     * åˆ é™¤ä»»åŠ¡
     */
    deleteTodo(id) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
            this.todos = this.todos.filter(t => t.id !== id);
            this.updateDisplay();
            this.saveToStorage();
            this.showMessage('ä»»åŠ¡å·²åˆ é™¤', 'info');
        }
    }
    
    /**
     * å¼€å§‹ç¼–è¾‘ä»»åŠ¡
     */
    startEdit(id) {
        const todoItem = this.container.querySelector(`[data-id="${id}"]`);
        const textSpan = todoItem.querySelector('.todo-text');
        const actionBtns = todoItem.querySelector('.action-btns');
        const editBtns = todoItem.querySelector('.edit-btns');
        
        const currentText = textSpan.textContent;
        textSpan.innerHTML = `<input type="text" class="edit-input" value="${currentText}">`;
        
        actionBtns.style.display = 'none';
        editBtns.style.display = 'block';
        
        const editInput = textSpan.querySelector('.edit-input');
        editInput.focus();
        editInput.select();
    }
    
    /**
     * ä¿å­˜ç¼–è¾‘
     */
    saveEdit(id) {
        const todoItem = this.container.querySelector(`[data-id="${id}"]`);
        const editInput = todoItem.querySelector('.edit-input');
        const newText = editInput.value.trim();
        
        if (!newText) {
            this.showMessage('ä»»åŠ¡å†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
            return;
        }
        
        const todo = this.todos.find(t => t.id === id);
        if (todo) {
            todo.text = newText;
            this.updateDisplay();
            this.saveToStorage();
            this.showMessage('ä»»åŠ¡å·²æ›´æ–°', 'success');
        }
    }
    
    /**
     * å–æ¶ˆç¼–è¾‘
     */
    cancelEdit(id) {
        this.updateDisplay();
    }
    
    /**
     * è®¾ç½®è¿‡æ»¤å™¨
     */
    setFilter(filter) {
        this.filter = filter;
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        this.container.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        this.container.querySelector(`[data-filter="${filter}"]`).classList.add('active');
        
        this.updateDisplay();
    }
    
    /**
     * æ¸…é™¤å·²å®Œæˆä»»åŠ¡
     */
    clearCompleted() {
        const completedCount = this.todos.filter(t => t.completed).length;
        if (completedCount === 0) {
            this.showMessage('æ²¡æœ‰å·²å®Œæˆçš„ä»»åŠ¡', 'info');
            return;
        }
        
        if (confirm(`ç¡®å®šè¦åˆ é™¤ ${completedCount} ä¸ªå·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿ`)) {
            this.todos = this.todos.filter(t => !t.completed);
            this.updateDisplay();
            this.saveToStorage();
            this.showMessage(`å·²åˆ é™¤ ${completedCount} ä¸ªä»»åŠ¡`, 'info');
        }
    }
    
    /**
     * å…¨é€‰/å–æ¶ˆå…¨é€‰
     */
    selectAll() {
        const allCompleted = this.todos.every(t => t.completed);
        this.todos.forEach(t => t.completed = !allCompleted);
        this.updateDisplay();
        this.saveToStorage();
        this.showMessage(allCompleted ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰å®Œæˆ', 'info');
    }
    
    /**
     * æ›´æ–°æ˜¾ç¤º
     */
    updateDisplay() {
        this.renderTodoList();
        this.updateStats();
        this.updateClearButton();
    }
    
    /**
     * æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
     */
    renderTodoList() {
        const todoList = this.container.querySelector('.todo-list');
        const filteredTodos = this.getFilteredTodos();
        
        if (filteredTodos.length === 0) {
            todoList.innerHTML = '<li class="empty-message">æš‚æ— ä»»åŠ¡</li>';
            return;
        }
        
        todoList.innerHTML = filteredTodos.map(todo => `
            <li class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                <label class="todo-label">
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''}>
                    <span class="todo-text">${this.escapeHtml(todo.text)}</span>
                </label>
                <div class="action-btns">
                    <button class="edit-btn">ç¼–è¾‘</button>
                    <button class="delete-btn">åˆ é™¤</button>
                </div>
                <div class="edit-btns" style="display: none;">
                    <button class="save-btn">ä¿å­˜</button>
                    <button class="cancel-btn">å–æ¶ˆ</button>
                </div>
            </li>
        `).join('');
    }
    
    /**
     * è·å–è¿‡æ»¤åçš„ä»»åŠ¡
     */
    getFilteredTodos() {
        switch (this.filter) {
            case 'active':
                return this.todos.filter(t => !t.completed);
            case 'completed':
                return this.todos.filter(t => t.completed);
            default:
                return this.todos;
        }
    }
    
    /**
     * æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
     */
    updateStats() {
        const totalCount = this.todos.length;
        const activeCount = this.todos.filter(t => !t.completed).length;
        const completedCount = totalCount - activeCount;
        
        const totalCountEl = this.container.querySelector('.total-count');
        const statsInfo = this.container.querySelector('.stats-info');
        
        totalCountEl.textContent = totalCount;
        statsInfo.innerHTML = `
            æ€»è®¡: <span class="total-count">${totalCount}</span> é¡¹ | 
            æœªå®Œæˆ: ${activeCount} | 
            å·²å®Œæˆ: ${completedCount}
        `;
    }
    
    /**
     * æ›´æ–°æ¸…é™¤æŒ‰é’®
     */
    updateClearButton() {
        const clearBtn = this.container.querySelector('.clear-completed');
        const completedCount = this.todos.filter(t => t.completed).length;
        
        if (completedCount > 0) {
            clearBtn.style.display = 'block';
            clearBtn.textContent = `æ¸…é™¤å·²å®Œæˆ (${completedCount})`;
        } else {
            clearBtn.style.display = 'none';
        }
    }
    
    /**
     * æ˜¾ç¤ºæ¶ˆæ¯æç¤º
     */
    showMessage(text, type = 'info') {
        const message = document.createElement('div');
        message.className = `message message-${type}`;
        message.textContent = text;
        message.style.cssText = `
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            padding: 10px 15px; border-radius: 4px; color: white;
            background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        `;
        
        document.body.appendChild(message);
        
        setTimeout(() => {
            message.remove();
        }, 3000);
    }
    
    /**
     * HTMLè½¬ä¹‰
     */
    escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
    
    /**
     * ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
     */
    saveToStorage() {
        try {
            localStorage.setItem('todoApp', JSON.stringify({
                todos: this.todos,
                nextId: this.nextId,
                filter: this.filter
            }));
        } catch (e) {
            console.error('ä¿å­˜å¤±è´¥:', e);
        }
    }
    
    /**
     * ä»æœ¬åœ°å­˜å‚¨åŠ è½½
     */
    loadFromStorage() {
        try {
            const data = localStorage.getItem('todoApp');
            if (data) {
                const parsed = JSON.parse(data);
                this.todos = parsed.todos || [];
                this.nextId = parsed.nextId || 1;
                this.filter = parsed.filter || 'all';
                
                this.setFilter(this.filter);
                this.updateDisplay();
            }
        } catch (e) {
            console.error('åŠ è½½å¤±è´¥:', e);
        }
    }
    
    /**
     * æ·»åŠ æ ·å¼
     */
    addStyles() {
        if (document.querySelector('#todo-app-styles')) return;
        
        const style = document.createElement('style');
        style.id = 'todo-app-styles';
        style.textContent = `
            .todo-app {
                max-width: 600px; margin: 20px auto;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;
            }
            .todo-header {
                background: #4CAF50; color: white; padding: 20px;
            }
            .todo-header h1 { margin: 0 0 15px 0; font-size: 24px; }
            .input-container { display: flex; gap: 10px; }
            .todo-input {
                flex: 1; padding: 10px; border: none; border-radius: 4px;
                font-size: 16px;
            }
            .add-btn {
                padding: 10px 20px; background: white; color: #4CAF50;
                border: none; border-radius: 4px; cursor: pointer; font-weight: bold;
            }
            .add-btn:disabled { opacity: 0.5; cursor: not-allowed; }
            .todo-main { background: white; }
            .filter-bar {
                padding: 15px 20px; border-bottom: 1px solid #eee;
                display: flex; gap: 10px;
            }
            .filter-btn {
                padding: 8px 16px; border: 1px solid #ddd; background: white;
                border-radius: 4px; cursor: pointer;
            }
            .filter-btn.active { background: #4CAF50; color: white; border-color: #4CAF50; }
            .todo-list { list-style: none; margin: 0; padding: 0; }
            .todo-item {
                display: flex; align-items: center; padding: 15px 20px;
                border-bottom: 1px solid #eee; gap: 10px;
            }
            .todo-item.completed { opacity: 0.6; }
            .todo-item.completed .todo-text { text-decoration: line-through; }
            .todo-label { display: flex; align-items: center; flex: 1; cursor: pointer; }
            .todo-checkbox { margin-right: 10px; }
            .todo-text { flex: 1; }
            .edit-input {
                flex: 1; padding: 5px; border: 1px solid #ddd; border-radius: 4px;
            }
            .action-btns, .edit-btns { display: flex; gap: 5px; }
            .edit-btn, .delete-btn, .save-btn, .cancel-btn {
                padding: 5px 10px; border: 1px solid #ddd; background: white;
                border-radius: 4px; cursor: pointer; font-size: 12px;
            }
            .delete-btn { color: #f44336; }
            .save-btn { color: #4CAF50; }
            .empty-message {
                padding: 40px 20px; text-align: center; color: #999;
                font-style: italic;
            }
            .todo-stats {
                padding: 15px 20px; background: #f9f9f9; border-top: 1px solid #eee;
                display: flex; justify-content: space-between; align-items: center;
            }
            .clear-completed {
                padding: 8px 16px; background: #f44336; color: white;
                border: none; border-radius: 4px; cursor: pointer; font-size: 12px;
            }
        `;
        document.head.appendChild(style);
    }
}

// ä½¿ç”¨ç¤ºä¾‹
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', () => {
        const appContainer = document.createElement('div');
        document.body.appendChild(appContainer);
        
        const todoApp = new TodoApp(appContainer);
        
        console.log('TodoListåº”ç”¨å·²å¯åŠ¨');
        console.log('å¿«æ·é”®: Ctrl+A (å…¨é€‰), Ctrl+D (æ¸…é™¤å·²å®Œæˆ)');
    });
}
```

---

**æœ¬ç« æ€»ç»“**

ç¬¬13ç« æ·±å…¥æ¢è®¨äº†JavaScriptäº‹ä»¶ä¸äº¤äº’ç³»ç»Ÿçš„æ ¸å¿ƒçŸ¥è¯†ï¼š

1. **äº‹ä»¶ç›‘å¬æœºåˆ¶**ï¼š
   - addEventListenerçš„æ ‡å‡†ç”¨æ³•å’Œé€‰é¡¹
   - äº‹ä»¶ç®¡ç†å’ŒEventManagerç±»  
   - å„ç§äº‹ä»¶ç±»å‹çš„åˆ†ç±»å’Œå¤„ç†

2. **äº‹ä»¶æµæœºåˆ¶**ï¼š
   - æ•è·ã€ç›®æ ‡ã€å†’æ³¡ä¸‰ä¸ªé˜¶æ®µ
   - äº‹ä»¶è·¯å¾„è¿½è¸ªå’Œé˜¶æ®µæ£€æµ‹
   - å®é™…åº”ç”¨ä¸­çš„äº‹ä»¶æµæ§åˆ¶

3. **äº‹ä»¶æ§åˆ¶**ï¼š
   - preventDefaulté˜»æ­¢é»˜è®¤è¡Œä¸º
   - stopPropagationæ§åˆ¶äº‹ä»¶ä¼ æ’­
   - æ¡ä»¶æ€§äº‹ä»¶æ§åˆ¶å’Œæœ€ä½³å®è·µ

4. **äº‹ä»¶å§”æ‰˜**ï¼š
   - åˆ©ç”¨äº‹ä»¶å†’æ³¡å®ç°é«˜æ•ˆç®¡ç†
   - delegateå·¥å…·å‡½æ•°çš„å®ç°
   - æ€§èƒ½ä¼˜åŒ–çš„å®é™…æ•ˆæœ

5. **ç”¨æˆ·äº¤äº’äº‹ä»¶**ï¼š
   - é¼ æ ‡äº‹ä»¶çš„å®Œæ•´å¤„ç†
   - é”®ç›˜äº‹ä»¶å’Œå¿«æ·é”®ç³»ç»Ÿ
   - æ‹–æ‹½åŠŸèƒ½çš„å®ç°

6. **å®æˆ˜åº”ç”¨**ï¼š
   - TodoListå®Œæ•´é¡¹ç›®
   - äº‹ä»¶ç®¡ç†çš„æœ€ä½³å®è·µ
   - æœ¬åœ°å­˜å‚¨é›†æˆ

**å…³é”®è¦ç‚¹**ï¼š
- ç°ä»£äº‹ä»¶å¤„ç†ä»¥addEventListenerä¸ºæ ‡å‡†
- ç†è§£äº‹ä»¶æµæœ‰åŠ©äºå¤æ‚äº¤äº’è®¾è®¡
- äº‹ä»¶å§”æ‰˜èƒ½æ˜¾è‘—æå‡æ€§èƒ½
- åˆç†çš„äº‹ä»¶æ§åˆ¶èƒ½æå‡ç”¨æˆ·ä½“éªŒ
- å®é™…é¡¹ç›®ä¸­éœ€è¦ç»Ÿä¸€çš„äº‹ä»¶ç®¡ç†ç­–ç•¥

**ä¸‹ä¸€ç« é¢„å‘Š**

ç¬¬14ç« å°†å­¦ä¹ BOMï¼ˆæµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼‰ï¼ŒåŒ…æ‹¬windowå¯¹è±¡ã€å®šæ—¶å™¨ã€locationå’Œhistoryå¯¹è±¡ã€æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorage/sessionStorage/cookieï¼‰ä»¥åŠæµè§ˆå™¨èƒ½åŠ›æ£€æµ‹ç­‰å†…å®¹ã€‚
   - æ•è·ã€ç›®æ ‡ã€å†’æ³¡ä¸‰ä¸ªé˜¶æ®µ
   - äº‹ä»¶è·¯å¾„è¿½è¸ªå’Œé˜¶æ®µæ£€æµ‹
   - å®é™…åº”ç”¨ä¸­çš„äº‹ä»¶æµæ§åˆ¶

3. **äº‹ä»¶æ§åˆ¶**ï¼š
   - preventDefaulté˜»æ­¢é»˜è®¤è¡Œä¸º
   - stopPropagationæ§åˆ¶äº‹ä»¶ä¼ æ’­
   - æ¡ä»¶æ€§äº‹ä»¶æ§åˆ¶å’Œæœ€ä½³å®è·µ

**å…³é”®è¦ç‚¹**ï¼š
- ç°ä»£äº‹ä»¶å¤„ç†ä»¥addEventListenerä¸ºæ ‡å‡†
- ç†è§£äº‹ä»¶æµæœ‰åŠ©äºå¤æ‚äº¤äº’è®¾è®¡
- åˆç†çš„äº‹ä»¶æ§åˆ¶èƒ½æå‡ç”¨æˆ·ä½“éªŒ
- äº‹ä»¶ç®¡ç†ç±»èƒ½ç®€åŒ–å¤æ‚åº”ç”¨çš„äº‹ä»¶å¤„ç†

**ä¸‹ä¸€ç« é¢„å‘Š**

ç¬¬14ç« å°†å­¦ä¹ BOMï¼ˆæµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼‰ï¼ŒåŒ…æ‹¬windowå¯¹è±¡ã€å®šæ—¶å™¨ã€locationå’Œhistoryå¯¹è±¡ã€æœ¬åœ°å­˜å‚¨ï¼ˆlocalStorage/sessionStorage/cookieï¼‰ä»¥åŠæµè§ˆå™¨èƒ½åŠ›æ£€æµ‹ç­‰å†…å®¹ã€‚
